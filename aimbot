-- ServerScriptService

-- Services
local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")
local SoundService = game:GetService("SoundService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local TeleportService = game:GetService("TeleportService")
local BadgeService = game:GetService("BadgeService")
local DataStoreService = game:GetService("DataStoreService")
local PhysicsService = game:GetService("PhysicsService")
local PathfindingService = game:GetService("PathfindingService")
local Chat = game:GetService("Chat")
local Teams = game:GetService("Teams")
local StarterGui = game:GetService("StarterGui")
local StarterPack = game:GetService("StarterPack")
local StarterPlayer = game:GetService("StarterPlayer")
local ContextActionService = game:GetService("ContextActionService")
local CoreGui = game:GetService("CoreGui")
local InsertService = game:GetService("InsertService")
local ContentProvider = game:GetService("ContentProvider")

local adminIds = {
	9766385891,
}

local activeTracking = {}
local activeESP = {}
local espEnabled = {}
local rightMouseTracking = {}
local espSettings = {}
local trackingMode = {}
local trackingSettings = {}
local toggleTrackingActive = {}
local currentTab = {}
local selectedPlayer = {}
local isRMBHeld = {}

local function isAdmin(player)
	for _, id in ipairs(adminIds) do
		if player.UserId == id then
			return true
		end
	end
	return false
end

local function isSameTeam(player1, player2)
	if not player1.Team or not player2.Team then
		return false
	end
	return player1.Team == player2.Team
end

local function isValidTarget(admin, target)
	if target == admin then
		return false
	end

	if isAdmin(target) then
		return false
	end

	if isSameTeam(admin, target) then
		return false
	end

	return true
end

local function hasLineOfSight(admin, target)
	local adminChar = admin.Character
	local targetChar = target.Character

	if not adminChar or not targetChar then
		return false
	end

	local adminHead = adminChar:FindFirstChild("Head")
	local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

	if not adminHead or not targetHRP then
		return false
	end

	local origin = adminHead.Position
	local destination = targetHRP.Position
	local direction = (destination - origin)
	local distance = direction.Magnitude

	local raycastParams = RaycastParams.new()
	raycastParams.FilterType = Enum.RaycastFilterType.Exclude
	raycastParams.FilterDescendantsInstances = {adminChar, targetChar}
	raycastParams.IgnoreWater = true

	local raycastResult = Workspace:Raycast(origin, direction.Unit * distance, raycastParams)

	if raycastResult then
		return false
	end

	return true
end

local function findPlayer(name)
	name = name:lower()
	for _, player in ipairs(Players:GetPlayers()) do
		if player.Name:lower():sub(1, #name) == name then
			return player
		end
	end
	return nil
end

local function getNearestValidTarget(admin, maxRange)
	local adminChar = admin.Character
	if not adminChar then return nil end

	local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
	if not adminHRP then return nil end

	local nearestPlayer = nil
	local nearestDistance = maxRange or math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if isValidTarget(admin, player) then
			local char = player.Character
			if char then
				local hrp = char:FindFirstChild("HumanoidRootPart")
				if hrp then
					local distance = (adminHRP.Position - hrp.Position).Magnitude

					local settings = trackingSettings[admin.UserId] or {}
					local requireLOS = settings.requireLineOfSight ~= false

					local canTrack = true
					if requireLOS then
						canTrack = hasLineOfSight(admin, player)
					end

					if distance < nearestDistance and canTrack then
						nearestDistance = distance
						nearestPlayer = player
					end
				end
			end
		end
	end

	return nearestPlayer, nearestDistance
end

local function stopTracking(admin)
	if activeTracking[admin.UserId] then
		if activeTracking[admin.UserId].connection then
			activeTracking[admin.UserId].connection:Disconnect()
		end
		activeTracking[admin.UserId] = nil
		return true
	end
	return false
end

local function stopRightMouseTracking(admin)
	if rightMouseTracking[admin.UserId] then
		if rightMouseTracking[admin.UserId].connection then
			rightMouseTracking[admin.UserId].connection:Disconnect()
		end
		rightMouseTracking[admin.UserId] = nil

		local camera = Workspace.CurrentCamera
		if camera then
			camera.CameraType = Enum.CameraType.Custom
		end
		return true
	end
	return false
end

-- Full unlock function
local function fullUnlock(player)
	local unlocked = {items = 0, stats = 0, tools = 0, gamepasses = 0}

	-- Unlock from ServerStorage
	if ServerStorage:FindFirstChild("Items") then
		for _, item in ipairs(ServerStorage.Items:GetChildren()) do
			if item:IsA("Tool") or item:IsA("HopperBin") then
				local clone = item:Clone()
				clone.Parent = player.Backpack
				unlocked.items = unlocked.items + 1
			end
		end
	end

	-- Unlock from ReplicatedStorage
	for _, item in ipairs(ReplicatedStorage:GetDescendants()) do
		if item:IsA("Tool") or item:IsA("HopperBin") then
			local clone = item:Clone()
			clone.Parent = player.Backpack
			unlocked.tools = unlocked.tools + 1
		end
	end

	-- Max all stats in leaderstats
	local leaderstats = player:FindFirstChild("leaderstats")
	if leaderstats then
		for _, stat in ipairs(leaderstats:GetChildren()) do
			if stat:IsA("IntValue") or stat:IsA("NumberValue") then
				stat.Value = 999999999
				unlocked.stats = unlocked.stats + 1
			elseif stat:IsA("StringValue") then
				-- Skip string values
			end
		end
	end

	-- Try to find and max other common data locations
	local dataFolders = {"Data", "PlayerData", "Stats", "Currency", "Money", "Coins", "Cash", "Points", "Gems", "Diamonds"}

	for _, folderName in ipairs(dataFolders) do
		local folder = player:FindFirstChild(folderName)
		if folder then
			for _, child in ipairs(folder:GetDescendants()) do
				if child:IsA("IntValue") or child:IsA("NumberValue") then
					child.Value = 999999999
					unlocked.stats = unlocked.stats + 1
				end
			end
		end
	end

	-- Unlock hidden tools in player
	for _, item in ipairs(player:GetDescendants()) do
		if item:IsA("Tool") and item.Parent ~= player.Backpack and item.Parent ~= player.Character then
			local clone = item:Clone()
			clone.Parent = player.Backpack
			unlocked.tools = unlocked.tools + 1
		end
	end

	-- Try to give all tools from Lighting (some games hide stuff there)
	for _, item in ipairs(Lighting:GetDescendants()) do
		if item:IsA("Tool") or item:IsA("HopperBin") then
			local clone = item:Clone()
			clone.Parent = player.Backpack
			unlocked.tools = unlocked.tools + 1
		end
	end

	-- StarterPack tools
	for _, item in ipairs(StarterPack:GetChildren()) do
		if item:IsA("Tool") or item:IsA("HopperBin") then
			if not player.Backpack:FindFirstChild(item.Name) then
				local clone = item:Clone()
				clone.Parent = player.Backpack
				unlocked.tools = unlocked.tools + 1
			end
		end
	end

	return unlocked
end

-- Compact ESP
local function createCompactESP(target, admin)
	if not target.Character then return nil end

	if not isValidTarget(admin, target) then
		return nil
	end

	local existingFolder = target.Character:FindFirstChild("AdminESP_" .. admin.UserId)
	if existingFolder then
		existingFolder:Destroy()
	end

	local espFolder = Instance.new("Folder")
	espFolder.Name = "AdminESP_" .. admin.UserId
	espFolder.Parent = target.Character

	local settings = espSettings[admin.UserId] or {
		boxEnabled = true,
		tracerEnabled = true,
		nameEnabled = true,
		healthEnabled = true,
		distanceEnabled = true
	}

	local billboardGui = Instance.new("BillboardGui")
	billboardGui.Name = "InfoBoard"
	billboardGui.Adornee = target.Character:FindFirstChild("Head")
	billboardGui.Size = UDim2.new(0, 120, 0, 45)
	billboardGui.StudsOffset = Vector3.new(0, 2, 0)
	billboardGui.AlwaysOnTop = true
	billboardGui.Parent = espFolder

	local infoFrame = Instance.new("Frame")
	infoFrame.Size = UDim2.new(1, 0, 1, 0)
	infoFrame.BackgroundTransparency = 1
	infoFrame.Parent = billboardGui

	local nameLabel = Instance.new("TextLabel")
	nameLabel.Name = "NameLabel"
	nameLabel.Size = UDim2.new(1, 0, 0, 14)
	nameLabel.Position = UDim2.new(0, 0, 0, 0)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Text = target.Name
	nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	nameLabel.TextStrokeTransparency = 0
	nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	nameLabel.TextSize = 11
	nameLabel.Font = Enum.Font.GothamBold
	nameLabel.Visible = settings.nameEnabled
	nameLabel.Parent = infoFrame

	local healthBarBg = Instance.new("Frame")
	healthBarBg.Name = "HealthBarBg"
	healthBarBg.Size = UDim2.new(0.7, 0, 0, 3)
	healthBarBg.Position = UDim2.new(0.15, 0, 0, 16)
	healthBarBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	healthBarBg.BorderSizePixel = 0
	healthBarBg.Visible = settings.healthEnabled
	healthBarBg.Parent = infoFrame

	local healthBarFill = Instance.new("Frame")
	healthBarFill.Name = "HealthBarFill"
	healthBarFill.Size = UDim2.new(1, 0, 1, 0)
	healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	healthBarFill.BorderSizePixel = 0
	healthBarFill.Parent = healthBarBg

	local distanceLabel = Instance.new("TextLabel")
	distanceLabel.Name = "DistanceLabel"
	distanceLabel.Size = UDim2.new(1, 0, 0, 12)
	distanceLabel.Position = UDim2.new(0, 0, 0, 21)
	distanceLabel.BackgroundTransparency = 1
	distanceLabel.Text = "0m"
	distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
	distanceLabel.TextStrokeTransparency = 0
	distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	distanceLabel.TextSize = 10
	distanceLabel.Font = Enum.Font.Gotham
	distanceLabel.Visible = settings.distanceEnabled
	distanceLabel.Parent = infoFrame

	local visibilityDot = Instance.new("Frame")
	visibilityDot.Name = "VisibilityDot"
	visibilityDot.Size = UDim2.new(0, 6, 0, 6)
	visibilityDot.Position = UDim2.new(0.5, -3, 0, 35)
	visibilityDot.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	visibilityDot.BorderSizePixel = 0
	visibilityDot.Parent = infoFrame

	local dotCorner = Instance.new("UICorner")
	dotCorner.CornerRadius = UDim.new(1, 0)
	dotCorner.Parent = visibilityDot

	local highlight = Instance.new("Highlight")
	highlight.Name = "BoxHighlight"
	highlight.Adornee = target.Character
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
	highlight.FillTransparency = 1
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Enabled = settings.boxEnabled
	highlight.Parent = espFolder

	local tracerPart = Instance.new("Part")
	tracerPart.Name = "TracerAnchor"
	tracerPart.Anchored = true
	tracerPart.CanCollide = false
	tracerPart.Transparency = 1
	tracerPart.Size = Vector3.new(0.1, 0.1, 0.1)
	tracerPart.Parent = espFolder

	local beam = Instance.new("Beam")
	beam.Name = "Tracer"
	beam.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0))
	beam.Transparency = NumberSequence.new(0.5)
	beam.Width0 = 0.05
	beam.Width1 = 0.05
	beam.FaceCamera = true
	beam.Enabled = settings.tracerEnabled
	beam.Parent = espFolder

	local attachment0 = Instance.new("Attachment")
	attachment0.Name = "TracerStart"
	attachment0.Parent = tracerPart

	local attachment1 = Instance.new("Attachment")
	attachment1.Name = "TracerEnd"
	attachment1.Parent = tracerPart

	beam.Attachment0 = attachment0
	beam.Attachment1 = attachment1

	return {
		folder = espFolder,
		highlight = highlight,
		billboard = billboardGui,
		nameLabel = nameLabel,
		healthBarBg = healthBarBg,
		healthBarFill = healthBarFill,
		distanceLabel = distanceLabel,
		visibilityDot = visibilityDot,
		beam = beam,
		tracerPart = tracerPart,
		attachment0 = attachment0,
		attachment1 = attachment1
	}
end

local function updateCompactESP(admin, target, espComponents)
	if not admin.Character or not target.Character then return false end

	if not isValidTarget(admin, target) then
		if espComponents.folder then
			espComponents.folder:Destroy()
		end
		return false
	end

	local adminHRP = admin.Character:FindFirstChild("HumanoidRootPart")
	local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
	local targetHumanoid = target.Character:FindFirstChild("Humanoid")

	if not adminHRP or not targetHRP then return true end

	local distance = (adminHRP.Position - targetHRP.Position).Magnitude
	local canSee = hasLineOfSight(admin, target)

	if espComponents.distanceLabel then
		espComponents.distanceLabel.Text = string.format("%.0fm", distance)
	end

	if targetHumanoid and espComponents.healthBarFill then
		local healthPercent = targetHumanoid.Health / targetHumanoid.MaxHealth
		espComponents.healthBarFill.Size = UDim2.new(healthPercent, 0, 1, 0)

		if healthPercent > 0.6 then
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		elseif healthPercent > 0.3 then
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
		else
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		end
	end

	if espComponents.visibilityDot then
		if canSee then
			espComponents.visibilityDot.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		else
			espComponents.visibilityDot.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		end
	end

	local espColor
	if distance < 30 then
		espColor = Color3.fromRGB(255, 50, 50)
	elseif distance < 75 then
		espColor = Color3.fromRGB(255, 165, 0)
	elseif distance < 150 then
		espColor = Color3.fromRGB(255, 255, 0)
	else
		espColor = Color3.fromRGB(0, 255, 0)
	end

	if espComponents.highlight then
		espComponents.highlight.OutlineColor = espColor
		espComponents.highlight.FillTransparency = canSee and 0.9 or 1
	end

	if espComponents.beam and espComponents.tracerPart then
		local camera = Workspace.CurrentCamera
		if camera then
			espComponents.tracerPart.Position = camera.CFrame.Position
			espComponents.attachment0.WorldPosition = camera.CFrame.Position + Vector3.new(0, -1.5, 0)
			espComponents.attachment1.WorldPosition = targetHRP.Position
			espComponents.beam.Color = ColorSequence.new(espColor)
		end
	end

	return true
end

local function clearAllESP(admin)
	if activeESP[admin.UserId] then
		for _, data in pairs(activeESP[admin.UserId]) do
			if data.connection then
				data.connection:Disconnect()
			end
			if data.components and data.components.folder then
				data.components.folder:Destroy()
			end
		end
		activeESP[admin.UserId] = nil
	end

	for _, player in ipairs(Players:GetPlayers()) do
		if player.Character then
			local folder = player.Character:FindFirstChild("AdminESP_" .. admin.UserId)
			if folder then
				folder:Destroy()
			end
		end
	end

	espEnabled[admin.UserId] = false
end

local function enableESP(admin)
	clearAllESP(admin)

	activeESP[admin.UserId] = {}
	espEnabled[admin.UserId] = true

	for _, target in ipairs(Players:GetPlayers()) do
		if isValidTarget(admin, target) then
			local components = createCompactESP(target, admin)
			if components then
				local connection = RunService.Heartbeat:Connect(function()
					if not espEnabled[admin.UserId] then
						return
					end
					local stillValid = updateCompactESP(admin, target, components)
					if not stillValid then
						if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
							activeESP[admin.UserId][target.UserId].connection:Disconnect()
							activeESP[admin.UserId][target.UserId] = nil
						end
					end
				end)

				activeESP[admin.UserId][target.UserId] = {
					components = components,
					connection = connection
				}
			end
		end
	end

	local playerAddedConn
	playerAddedConn = Players.PlayerAdded:Connect(function(target)
		if not espEnabled[admin.UserId] then
			playerAddedConn:Disconnect()
			return
		end

		target.CharacterAdded:Wait()
		task.wait(1)

		if espEnabled[admin.UserId] and isValidTarget(admin, target) then
			local components = createCompactESP(target, admin)
			if components then
				local connection = RunService.Heartbeat:Connect(function()
					if not espEnabled[admin.UserId] then
						return
					end
					updateCompactESP(admin, target, components)
				end)

				if not activeESP[admin.UserId] then
					activeESP[admin.UserId] = {}
				end

				activeESP[admin.UserId][target.UserId] = {
					components = components,
					connection = connection
				}
			end
		end
	end)

	for _, target in ipairs(Players:GetPlayers()) do
		if target ~= admin then
			target.CharacterAdded:Connect(function()
				if espEnabled[admin.UserId] and isValidTarget(admin, target) then
					task.wait(1)

					if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
						if activeESP[admin.UserId][target.UserId].connection then
							activeESP[admin.UserId][target.UserId].connection:Disconnect()
						end
						if activeESP[admin.UserId][target.UserId].components and activeESP[admin.UserId][target.UserId].components.folder then
							activeESP[admin.UserId][target.UserId].components.folder:Destroy()
						end
					end

					local components = createCompactESP(target, admin)
					if components then
						local connection = RunService.Heartbeat:Connect(function()
							if not espEnabled[admin.UserId] then
								return
							end
							updateCompactESP(admin, target, components)
						end)

						if not activeESP[admin.UserId] then
							activeESP[admin.UserId] = {}
						end

						activeESP[admin.UserId][target.UserId] = {
							components = components,
							connection = connection
						}
					end
				end
			end)

			target:GetPropertyChangedSignal("Team"):Connect(function()
				if espEnabled[admin.UserId] then
					if not isValidTarget(admin, target) then
						if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
							if activeESP[admin.UserId][target.UserId].connection then
								activeESP[admin.UserId][target.UserId].connection:Disconnect()
							end
							if activeESP[admin.UserId][target.UserId].components and activeESP[admin.UserId][target.UserId].components.folder then
								activeESP[admin.UserId][target.UserId].components.folder:Destroy()
							end
							activeESP[admin.UserId][target.UserId] = nil
						end
					else
						if (not activeESP[admin.UserId] or not activeESP[admin.UserId][target.UserId]) and target.Character then
							local components = createCompactESP(target, admin)
							if components then
								local connection = RunService.Heartbeat:Connect(function()
									if not espEnabled[admin.UserId] then
										return
									end
									updateCompactESP(admin, target, components)
								end)

								if not activeESP[admin.UserId] then
									activeESP[admin.UserId] = {}
								end

								activeESP[admin.UserId][target.UserId] = {
									components = components,
									connection = connection
								}
							end
						end
					end
				end
			end)
		end
	end
end

-- Loading Screen
local function showLoadingScreen(player)
	local loadingGui = Instance.new("ScreenGui")
	loadingGui.Name = "LoadingScreen"
	loadingGui.ResetOnSpawn = false
	loadingGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	loadingGui.DisplayOrder = 999
	loadingGui.Parent = player:WaitForChild("PlayerGui")

	local background = Instance.new("Frame")
	background.Size = UDim2.new(1, 0, 1, 0)
	background.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
	background.BorderSizePixel = 0
	background.Parent = loadingGui

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(1, 0, 0, 60)
	titleLabel.Position = UDim2.new(0, 0, 0.35, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "ADMIN PANEL"
	titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleLabel.TextSize = 42
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.Parent = background

	local byLabel = Instance.new("TextLabel")
	byLabel.Size = UDim2.new(1, 0, 0, 30)
	byLabel.Position = UDim2.new(0, 0, 0.35, 60)
	byLabel.BackgroundTransparency = 1
	byLabel.Text = "made by bixix"
	byLabel.TextColor3 = Color3.fromRGB(88, 101, 242)
	byLabel.TextSize = 24
	byLabel.Font = Enum.Font.GothamMedium
	byLabel.Parent = background

	local loadingBar = Instance.new("Frame")
	loadingBar.Size = UDim2.new(0.3, 0, 0, 4)
	loadingBar.Position = UDim2.new(0.35, 0, 0.55, 0)
	loadingBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
	loadingBar.BorderSizePixel = 0
	loadingBar.Parent = background

	local loadingCorner = Instance.new("UICorner")
	loadingCorner.CornerRadius = UDim.new(0, 2)
	loadingCorner.Parent = loadingBar

	local loadingFill = Instance.new("Frame")
	loadingFill.Size = UDim2.new(0, 0, 1, 0)
	loadingFill.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
	loadingFill.BorderSizePixel = 0
	loadingFill.Parent = loadingBar

	local fillCorner = Instance.new("UICorner")
	fillCorner.CornerRadius = UDim.new(0, 2)
	fillCorner.Parent = loadingFill

	local statusLabel = Instance.new("TextLabel")
	statusLabel.Size = UDim2.new(1, 0, 0, 20)
	statusLabel.Position = UDim2.new(0, 0, 0.55, 15)
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "Initializing..."
	statusLabel.TextColor3 = Color3.fromRGB(150, 150, 160)
	statusLabel.TextSize = 12
	statusLabel.Font = Enum.Font.Gotham
	statusLabel.Parent = background

	local versionLabel = Instance.new("TextLabel")
	versionLabel.Size = UDim2.new(1, 0, 0, 20)
	versionLabel.Position = UDim2.new(0, 0, 1, -30)
	versionLabel.BackgroundTransparency = 1
	versionLabel.Text = "v2.1.0 â€¢ Premium Edition"
	versionLabel.TextColor3 = Color3.fromRGB(80, 80, 90)
	versionLabel.TextSize = 11
	versionLabel.Font = Enum.Font.Gotham
	versionLabel.Parent = background

	-- Animate loading
	local loadingSteps = {
		{progress = 0.2, text = "Loading modules..."},
		{progress = 0.4, text = "Setting up ESP..."},
		{progress = 0.6, text = "Configuring tracking..."},
		{progress = 0.8, text = "Building interface..."},
		{progress = 1.0, text = "Complete!"},
	}

	for _, step in ipairs(loadingSteps) do
		TweenService:Create(loadingFill, TweenInfo.new(0.4), {Size = UDim2.new(step.progress, 0, 1, 0)}):Play()
		statusLabel.Text = step.text
		task.wait(0.5)
	end

	task.wait(0.3)

	-- Fade out
	TweenService:Create(background, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
	TweenService:Create(titleLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
	TweenService:Create(byLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
	TweenService:Create(loadingBar, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
	TweenService:Create(loadingFill, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
	TweenService:Create(statusLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
	TweenService:Create(versionLabel, TweenInfo.new(0.5), {TextTransparency = 1}):Play()

	task.wait(0.6)
	loadingGui:Destroy()
end

local function createAdminGui(player)
	-- Show loading screen first
	showLoadingScreen(player)

	-- Initialize settings
	espSettings[player.UserId] = {
		boxEnabled = true,
		tracerEnabled = true,
		nameEnabled = true,
		healthEnabled = true,
		distanceEnabled = true
	}
	trackingMode[player.UserId] = "hold"
	trackingSettings[player.UserId] = {
		sensitivity = 0.15,
		maxRange = 500,
		requireLineOfSight = true,
		smoothness = 0.1,
		lockOnTime = 0
	}
	toggleTrackingActive[player.UserId] = false
	currentTab[player.UserId] = "Information"
	selectedPlayer[player.UserId] = nil
	isRMBHeld[player.UserId] = false

	-- Main ScreenGui
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "AdminPanel"
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.Parent = player:WaitForChild("PlayerGui")

	-- Main Container
	local mainFrame = Instance.new("Frame")
	mainFrame.Name = "MainFrame"
	mainFrame.Size = UDim2.new(0, 700, 0, 480)
	mainFrame.Position = UDim2.new(0.5, -350, 0.5, -240)
	mainFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
	mainFrame.BorderSizePixel = 0
	mainFrame.Visible = false
	mainFrame.Active = true
	mainFrame.Draggable = true
	mainFrame.Parent = screenGui

	local mainCorner = Instance.new("UICorner")
	mainCorner.CornerRadius = UDim.new(0, 6)
	mainCorner.Parent = mainFrame

	local mainStroke = Instance.new("UIStroke")
	mainStroke.Color = Color3.fromRGB(50, 50, 60)
	mainStroke.Thickness = 1
	mainStroke.Parent = mainFrame

	-- Header
	local header = Instance.new("Frame")
	header.Name = "Header"
	header.Size = UDim2.new(1, 0, 0, 45)
	header.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
	header.BorderSizePixel = 0
	header.Parent = mainFrame

	local headerCorner = Instance.new("UICorner")
	headerCorner.CornerRadius = UDim.new(0, 6)
	headerCorner.Parent = header

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(0, 200, 1, 0)
	titleLabel.Position = UDim2.new(0.5, -100, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "Admin Panel"
	titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleLabel.TextSize = 18
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.Parent = header

	local byBixix = Instance.new("TextLabel")
	byBixix.Size = UDim2.new(0, 100, 0, 20)
	byBixix.Position = UDim2.new(0, 15, 0.5, -10)
	byBixix.BackgroundTransparency = 1
	byBixix.Text = "by bixix"
	byBixix.TextColor3 = Color3.fromRGB(88, 101, 242)
	byBixix.TextSize = 12
	byBixix.Font = Enum.Font.GothamMedium
	byBixix.TextXAlignment = Enum.TextXAlignment.Left
	byBixix.Parent = header

	-- Search Bar
	local searchFrame = Instance.new("Frame")
	searchFrame.Size = UDim2.new(0, 200, 0, 28)
	searchFrame.Position = UDim2.new(1, -260, 0.5, -14)
	searchFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
	searchFrame.BorderSizePixel = 0
	searchFrame.Parent = header

	local searchCorner = Instance.new("UICorner")
	searchCorner.CornerRadius = UDim.new(0, 4)
	searchCorner.Parent = searchFrame

	local searchIcon = Instance.new("TextLabel")
	searchIcon.Size = UDim2.new(0, 28, 1, 0)
	searchIcon.BackgroundTransparency = 1
	searchIcon.Text = "ðŸ”"
	searchIcon.TextColor3 = Color3.fromRGB(100, 100, 110)
	searchIcon.TextSize = 12
	searchIcon.Font = Enum.Font.Gotham
	searchIcon.Parent = searchFrame

	local searchBox = Instance.new("TextBox")
	searchBox.Name = "SearchBox"
	searchBox.Size = UDim2.new(1, -35, 1, 0)
	searchBox.Position = UDim2.new(0, 28, 0, 0)
	searchBox.BackgroundTransparency = 1
	searchBox.Text = ""
	searchBox.PlaceholderText = "Search"
	searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	searchBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 110)
	searchBox.TextSize = 12
	searchBox.Font = Enum.Font.Gotham
	searchBox.TextXAlignment = Enum.TextXAlignment.Left
	searchBox.ClearTextOnFocus = false
	searchBox.Parent = searchFrame

	-- Close button
	local closeBtn = Instance.new("TextButton")
	closeBtn.Size = UDim2.new(0, 20, 0, 20)
	closeBtn.Position = UDim2.new(1, -30, 0.5, -10)
	closeBtn.BackgroundTransparency = 1
	closeBtn.Text = "âœ•"
	closeBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
	closeBtn.TextSize = 16
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.Parent = header

	-- Sidebar
	local sidebar = Instance.new("Frame")
	sidebar.Name = "Sidebar"
	sidebar.Size = UDim2.new(0, 180, 1, -45)
	sidebar.Position = UDim2.new(0, 0, 0, 45)
	sidebar.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
	sidebar.BorderSizePixel = 0
	sidebar.Parent = mainFrame

	local sidebarLine = Instance.new("Frame")
	sidebarLine.Size = UDim2.new(0, 1, 1, 0)
	sidebarLine.Position = UDim2.new(1, 0, 0, 0)
	sidebarLine.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
	sidebarLine.BorderSizePixel = 0
	sidebarLine.Parent = sidebar

	-- Tab buttons
	local tabs = {
		{name = "Information", icon = "ðŸ“‹"},
		{name = "Players", icon = "ðŸ‘¥"},
		{name = "Local Player", icon = "ðŸ‘¤"},
		{name = "Visuals", icon = "ðŸ‘"},
		{name = "Tracking", icon = "ðŸŽ¯"},
		{name = "Commands", icon = "â—‡"},
		{name = "Settings", icon = "âš™"},
	}

	local tabButtons = {}
	local tabContents = {}

	for i, tab in ipairs(tabs) do
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = tab.name .. "Tab"
		tabBtn.Size = UDim2.new(1, -10, 0, 35)
		tabBtn.Position = UDim2.new(0, 5, 0, 10 + (i - 1) * 40)
		tabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
		tabBtn.BackgroundTransparency = 1
		tabBtn.BorderSizePixel = 0
		tabBtn.Text = ""
		tabBtn.AutoButtonColor = false
		tabBtn.Parent = sidebar

		local tabCorner = Instance.new("UICorner")
		tabCorner.CornerRadius = UDim.new(0, 4)
		tabCorner.Parent = tabBtn

		local tabIcon = Instance.new("TextLabel")
		tabIcon.Size = UDim2.new(0, 30, 1, 0)
		tabIcon.Position = UDim2.new(0, 8, 0, 0)
		tabIcon.BackgroundTransparency = 1
		tabIcon.Text = tab.icon
		tabIcon.TextColor3 = Color3.fromRGB(150, 150, 160)
		tabIcon.TextSize = 14
		tabIcon.Font = Enum.Font.Gotham
		tabIcon.Parent = tabBtn

		local tabLabel = Instance.new("TextLabel")
		tabLabel.Size = UDim2.new(1, -45, 1, 0)
		tabLabel.Position = UDim2.new(0, 40, 0, 0)
		tabLabel.BackgroundTransparency = 1
		tabLabel.Text = tab.name
		tabLabel.TextColor3 = Color3.fromRGB(180, 180, 185)
		tabLabel.TextSize = 13
		tabLabel.Font = Enum.Font.Gotham
		tabLabel.TextXAlignment = Enum.TextXAlignment.Left
		tabLabel.Parent = tabBtn

		local activeIndicator = Instance.new("Frame")
		activeIndicator.Name = "Indicator"
		activeIndicator.Size = UDim2.new(0, 3, 0.6, 0)
		activeIndicator.Position = UDim2.new(0, 0, 0.2, 0)
		activeIndicator.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
		activeIndicator.BorderSizePixel = 0
		activeIndicator.Visible = false
		activeIndicator.Parent = tabBtn

		local indicatorCorner = Instance.new("UICorner")
		indicatorCorner.CornerRadius = UDim.new(0, 2)
		indicatorCorner.Parent = activeIndicator

		tabButtons[tab.name] = {button = tabBtn, icon = tabIcon, label = tabLabel, indicator = activeIndicator}
	end

	-- Content Area
	local contentArea = Instance.new("Frame")
	contentArea.Name = "ContentArea"
	contentArea.Size = UDim2.new(1, -180, 1, -45)
	contentArea.Position = UDim2.new(0, 180, 0, 45)
	contentArea.BackgroundColor3 = Color3.fromRGB(28, 28, 32)
	contentArea.BorderSizePixel = 0
	contentArea.Parent = mainFrame

	-- Status bar
	local statusLabel = Instance.new("TextLabel")
	statusLabel.Name = "StatusLabel"
	statusLabel.Size = UDim2.new(1, 0, 0, 20)
	statusLabel.Position = UDim2.new(0, 0, 1, -25)
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "Ready â€¢ Right Ctrl to toggle â€¢ made by bixix"
	statusLabel.TextColor3 = Color3.fromRGB(100, 100, 110)
	statusLabel.TextSize = 10
	statusLabel.Font = Enum.Font.Gotham
	statusLabel.Parent = mainFrame

	-- Helper functions
	local function createContentPage(name)
		local page = Instance.new("ScrollingFrame")
		page.Name = name .. "Content"
		page.Size = UDim2.new(1, -20, 1, -20)
		page.Position = UDim2.new(0, 10, 0, 10)
		page.BackgroundTransparency = 1
		page.ScrollBarThickness = 3
		page.ScrollBarImageColor3 = Color3.fromRGB(88, 101, 242)
		page.CanvasSize = UDim2.new(0, 0, 0, 600)
		page.Visible = false
		page.Parent = contentArea
		return page
	end

	local function createToggleRow(parent, text, posY, default, callback)
		local row = Instance.new("Frame")
		row.Size = UDim2.new(1, 0, 0, 32)
		row.Position = UDim2.new(0, 0, 0, posY)
		row.BackgroundTransparency = 1
		row.Parent = parent

		local label = Instance.new("TextLabel")
		label.Size = UDim2.new(1, -60, 1, 0)
		label.Position = UDim2.new(0, 5, 0, 0)
		label.BackgroundTransparency = 1
		label.Text = text
		label.TextColor3 = Color3.fromRGB(180, 180, 185)
		label.TextSize = 12
		label.Font = Enum.Font.Gotham
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.Parent = row

		local toggleBg = Instance.new("Frame")
		toggleBg.Size = UDim2.new(0, 38, 0, 18)
		toggleBg.Position = UDim2.new(1, -45, 0.5, -9)
		toggleBg.BackgroundColor3 = default and Color3.fromRGB(88, 101, 242) or Color3.fromRGB(50, 50, 55)
		toggleBg.BorderSizePixel = 0
		toggleBg.Parent = row

		local toggleCorner = Instance.new("UICorner")
		toggleCorner.CornerRadius = UDim.new(1, 0)
		toggleCorner.Parent = toggleBg

		local toggleCircle = Instance.new("Frame")
		toggleCircle.Size = UDim2.new(0, 14, 0, 14)
		toggleCircle.Position = default and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
		toggleCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		toggleCircle.BorderSizePixel = 0
		toggleCircle.Parent = toggleBg

		local circleCorner = Instance.new("UICorner")
		circleCorner.CornerRadius = UDim.new(1, 0)
		circleCorner.Parent = toggleCircle

		local isEnabled = default

		local toggleBtn = Instance.new("TextButton")
		toggleBtn.Size = UDim2.new(1, 0, 1, 0)
		toggleBtn.BackgroundTransparency = 1
		toggleBtn.Text = ""
		toggleBtn.Parent = row

		toggleBtn.MouseButton1Click:Connect(function()
			isEnabled = not isEnabled

			if isEnabled then
				TweenService:Create(toggleBg, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(88, 101, 242)}):Play()
				TweenService:Create(toggleCircle, TweenInfo.new(0.15), {Position = UDim2.new(1, -16, 0.5, -7)}):Play()
			else
				TweenService:Create(toggleBg, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
				TweenService:Create(toggleCircle, TweenInfo.new(0.15), {Position = UDim2.new(0, 2, 0.5, -7)}):Play()
			end

			callback(isEnabled)
		end)

		return row, function() return isEnabled end
	end

	local function createSliderRow(parent, text, posY, min, max, default, callback)
		local row = Instance.new("Frame")
		row.Size = UDim2.new(1, 0, 0, 45)
		row.Position = UDim2.new(0, 0, 0, posY)
		row.BackgroundTransparency = 1
		row.Parent = parent

		local label = Instance.new("TextLabel")
		label.Size = UDim2.new(0.6, 0, 0, 20)
		label.Position = UDim2.new(0, 5, 0, 0)
		label.BackgroundTransparency = 1
		label.Text = text
		label.TextColor3 = Color3.fromRGB(180, 180, 185)
		label.TextSize = 12
		label.Font = Enum.Font.Gotham
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.Parent = row

		local valueLabel = Instance.new("TextLabel")
		valueLabel.Size = UDim2.new(0.35, 0, 0, 20)
		valueLabel.Position = UDim2.new(0.6, 0, 0, 0)
		valueLabel.BackgroundTransparency = 1
		valueLabel.Text = tostring(default)
		valueLabel.TextColor3 = Color3.fromRGB(88, 101, 242)
		valueLabel.TextSize = 12
		valueLabel.Font = Enum.Font.GothamBold
		valueLabel.TextXAlignment = Enum.TextXAlignment.Right
		valueLabel.Parent = row

		local sliderBg = Instance.new("Frame")
		sliderBg.Size = UDim2.new(1, -10, 0, 6)
		sliderBg.Position = UDim2.new(0, 5, 0, 28)
		sliderBg.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
		sliderBg.BorderSizePixel = 0
		sliderBg.Parent = row

		local sliderCorner = Instance.new("UICorner")
		sliderCorner.CornerRadius = UDim.new(0, 3)
		sliderCorner.Parent = sliderBg

		local sliderFill = Instance.new("Frame")
		sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
		sliderFill.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
		sliderFill.BorderSizePixel = 0
		sliderFill.Parent = sliderBg

		local fillCorner = Instance.new("UICorner")
		fillCorner.CornerRadius = UDim.new(0, 3)
		fillCorner.Parent = sliderFill

		local sliderBtn = Instance.new("TextButton")
		sliderBtn.Size = UDim2.new(1, 0, 1, 10)
		sliderBtn.Position = UDim2.new(0, 0, 0, -5)
		sliderBtn.BackgroundTransparency = 1
		sliderBtn.Text = ""
		sliderBtn.Parent = sliderBg

		local dragging = false

		sliderBtn.MouseButton1Down:Connect(function()
			dragging = true
		end)

		UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = false
			end
		end)

		RunService.RenderStepped:Connect(function()
			if dragging then
				local mouse = UserInputService:GetMouseLocation()
				local sliderPos = sliderBg.AbsolutePosition
				local sliderSize = sliderBg.AbsoluteSize

				local relativeX = math.clamp((mouse.X - sliderPos.X) / sliderSize.X, 0, 1)
				local value = min + (max - min) * relativeX

				if max >= 1 then
					value = math.floor(value)
				else
					value = math.floor(value * 100) / 100
				end

				sliderFill.Size = UDim2.new(relativeX, 0, 1, 0)
				valueLabel.Text = tostring(value)
				callback(value)
			end
		end)

		return row
	end

	local function createButtonRow(parent, text, posY, callback)
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1, -10, 0, 32)
		btn.Position = UDim2.new(0, 5, 0, posY)
		btn.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
		btn.BorderSizePixel = 0
		btn.Text = ""
		btn.AutoButtonColor = false
		btn.Parent = parent

		local btnCorner = Instance.new("UICorner")
		btnCorner.CornerRadius = UDim.new(0, 4)
		btnCorner.Parent = btn

		local btnLabel = Instance.new("TextLabel")
		btnLabel.Size = UDim2.new(1, -10, 1, 0)
		btnLabel.Position = UDim2.new(0, 10, 0, 0)
		btnLabel.BackgroundTransparency = 1
		btnLabel.Text = text
		btnLabel.TextColor3 = Color3.fromRGB(200, 200, 205)
		btnLabel.TextSize = 12
		btnLabel.Font = Enum.Font.Gotham
		btnLabel.TextXAlignment = Enum.TextXAlignment.Left
		btnLabel.Parent = btn

		btn.MouseEnter:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
		end)

		btn.MouseLeave:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(40, 40, 48)}):Play()
		end)

		btn.MouseButton1Click:Connect(callback)

		return btn, btnLabel
	end

	local function createSectionHeader(parent, text, posY)
		local header = Instance.new("TextLabel")
		header.Size = UDim2.new(1, 0, 0, 25)
		header.Position = UDim2.new(0, 5, 0, posY)
		header.BackgroundTransparency = 1
		header.Text = text
		header.TextColor3 = Color3.fromRGB(120, 120, 130)
		header.TextSize = 11
		header.Font = Enum.Font.GothamBold
		header.TextXAlignment = Enum.TextXAlignment.Left
		header.Parent = parent
		return header
	end

	-- ============ INFORMATION TAB ============
	local infoPage = createContentPage("Information")
	tabContents["Information"] = infoPage

	createSectionHeader(infoPage, "Update Log", 0)

	local updateLog = Instance.new("TextLabel")
	updateLog.Size = UDim2.new(1, -10, 0, 180)
	updateLog.Position = UDim2.new(0, 5, 0, 30)
	updateLog.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
	updateLog.Text = [[
  v2.1.0 - made by bixix
  
  + Loading screen with credits
  + Player list with click-to-select
  + Adjustable tracking settings
  + Improved RMB hold detection
  + Full unlock system (all items & currency)
  + Compact ESP with outline only
  + Team & Admin filtering
  + Line of sight detection
  
  Controls:
  â€¢ Right Ctrl - Toggle panel
  â€¢ RMB - Track nearest enemy
  ]]
	updateLog.TextColor3 = Color3.fromRGB(180, 180, 185)
	updateLog.TextSize = 11
	updateLog.Font = Enum.Font.Code
	updateLog.TextXAlignment = Enum.TextXAlignment.Left
	updateLog.TextYAlignment = Enum.TextYAlignment.Top
	updateLog.TextWrapped = true
	updateLog.Parent = infoPage

	local logCorner = Instance.new("UICorner")
	logCorner.CornerRadius = UDim.new(0, 4)
	logCorner.Parent = updateLog

	local logPadding = Instance.new("UIPadding")
	logPadding.PaddingLeft = UDim.new(0, 10)
	logPadding.PaddingTop = UDim.new(0, 10)
	logPadding.Parent = updateLog

	-- ============ PLAYERS TAB ============
	local playersPage = createContentPage("Players")
	tabContents["Players"] = playersPage

	createSectionHeader(playersPage, "Online Players (Click to Select)", 0)

	local playerListFrame = Instance.new("Frame")
	playerListFrame.Name = "PlayerList"
	playerListFrame.Size = UDim2.new(1, -10, 0, 280)
	playerListFrame.Position = UDim2.new(0, 5, 0, 30)
	playerListFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
	playerListFrame.BorderSizePixel = 0
	playerListFrame.ClipsDescendants = true
	playerListFrame.Parent = playersPage

	local playerListCorner = Instance.new("UICorner")
	playerListCorner.CornerRadius = UDim.new(0, 4)
	playerListCorner.Parent = playerListFrame

	local playerListScroll = Instance.new("ScrollingFrame")
	playerListScroll.Size = UDim2.new(1, 0, 1, 0)
	playerListScroll.BackgroundTransparency = 1
	playerListScroll.ScrollBarThickness = 3
	playerListScroll.ScrollBarImageColor3 = Color3.fromRGB(88, 101, 242)
	playerListScroll.Parent = playerListFrame

	local playerListLayout = Instance.new("UIListLayout")
	playerListLayout.Padding = UDim.new(0, 2)
	playerListLayout.Parent = playerListScroll

	local selectedLabel = Instance.new("TextLabel")
	selectedLabel.Name = "SelectedLabel"
	selectedLabel.Size = UDim2.new(1, -10, 0, 25)
	selectedLabel.Position = UDim2.new(0, 5, 0, 320)
	selectedLabel.BackgroundTransparency = 1
	selectedLabel.Text = "Selected: None"
	selectedLabel.TextColor3 = Color3.fromRGB(88, 101, 242)
	selectedLabel.TextSize = 13
	selectedLabel.Font = Enum.Font.GothamBold
	selectedLabel.TextXAlignment = Enum.TextXAlignment.Left
	selectedLabel.Parent = playersPage

	createSectionHeader(playersPage, "Quick Actions", 350)

	createButtonRow(playersPage, "Teleport to Selected", 380, function()
		local target = selectedPlayer[player.UserId]
		if not target then
			statusLabel.Text = "No player selected"
			return
		end

		local adminChar = player.Character
		local targetChar = target.Character

		if adminChar and targetChar then
			local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if adminHRP and targetHRP then
				adminHRP.CFrame = targetHRP.CFrame * CFrame.new(0, 0, 3)
				statusLabel.Text = "Teleported to " .. target.Name
			end
		end
	end)

	createButtonRow(playersPage, "Bring Selected", 417, function()
		local target = selectedPlayer[player.UserId]
		if not target then
			statusLabel.Text = "No player selected"
			return
		end

		local adminChar = player.Character
		local targetChar = target.Character

		if adminChar and targetChar then
			local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if adminHRP and targetHRP then
				targetHRP.CFrame = adminHRP.CFrame * CFrame.new(0, 0, 3)
				statusLabel.Text = "Brought " .. target.Name
			end
		end
	end)

	createButtonRow(playersPage, "Track Selected (Camera)", 454, function()
		local target = selectedPlayer[player.UserId]
		if not target then
			statusLabel.Text = "No player selected"
			return
		end

		stopTracking(player)

		statusLabel.Text = "Tracking " .. target.Name

		local camera = Workspace.CurrentCamera
		local settings = trackingSettings[player.UserId]

		local connection = RunService.RenderStepped:Connect(function()
			local adminChar = player.Character
			local targetChar = target.Character

			if not adminChar or not targetChar then return end

			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if targetHRP and camera then
				local canSee = not settings.requireLineOfSight or hasLineOfSight(player, target)

				if canSee then
					local lookAtCFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position)
					camera.CFrame = camera.CFrame:Lerp(lookAtCFrame, settings.sensitivity)
				end
			end
		end)

		activeTracking[player.UserId] = {
			connection = connection,
			target = target
		}
	end)

	-- Function to update player list
	local function updatePlayerList()
		for _, child in ipairs(playerListScroll:GetChildren()) do
			if child:IsA("TextButton") then
				child:Destroy()
			end
		end

		local playerCount = 0
		for _, p in ipairs(Players:GetPlayers()) do
			playerCount = playerCount + 1

			local playerBtn = Instance.new("TextButton")
			playerBtn.Name = p.Name
			playerBtn.Size = UDim2.new(1, -6, 0, 36)
			playerBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
			playerBtn.BorderSizePixel = 0
			playerBtn.Text = ""
			playerBtn.AutoButtonColor = false
			playerBtn.Parent = playerListScroll

			local btnCorner = Instance.new("UICorner")
			btnCorner.CornerRadius = UDim.new(0, 4)
			btnCorner.Parent = playerBtn

			-- Player icon
			local iconFrame = Instance.new("Frame")
			iconFrame.Size = UDim2.new(0, 28, 0, 28)
			iconFrame.Position = UDim2.new(0, 5, 0.5, -14)
			iconFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
			iconFrame.Parent = playerBtn

			local iconCorner = Instance.new("UICorner")
			iconCorner.CornerRadius = UDim.new(0, 4)
			iconCorner.Parent = iconFrame

			local iconText = Instance.new("TextLabel")
			iconText.Size = UDim2.new(1, 0, 1, 0)
			iconText.BackgroundTransparency = 1
			iconText.Text = p.Name:sub(1, 1):upper()
			iconText.TextColor3 = Color3.fromRGB(255, 255, 255)
			iconText.TextSize = 14
			iconText.Font = Enum.Font.GothamBold
			iconText.Parent = iconFrame

			-- Name
			local nameLabel = Instance.new("TextLabel")
			nameLabel.Size = UDim2.new(0.5, -40, 0, 16)
			nameLabel.Position = UDim2.new(0, 40, 0, 4)
			nameLabel.BackgroundTransparency = 1
			nameLabel.Text = p.Name
			nameLabel.TextColor3 = Color3.fromRGB(220, 220, 225)
			nameLabel.TextSize = 12
			nameLabel.Font = Enum.Font.GothamBold
			nameLabel.TextXAlignment = Enum.TextXAlignment.Left
			nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
			nameLabel.Parent = playerBtn

			-- Display name
			local displayLabel = Instance.new("TextLabel")
			displayLabel.Size = UDim2.new(0.5, -40, 0, 14)
			displayLabel.Position = UDim2.new(0, 40, 0, 19)
			displayLabel.BackgroundTransparency = 1
			displayLabel.Text = "@" .. p.DisplayName
			displayLabel.TextColor3 = Color3.fromRGB(120, 120, 130)
			displayLabel.TextSize = 10
			displayLabel.Font = Enum.Font.Gotham
			displayLabel.TextXAlignment = Enum.TextXAlignment.Left
			displayLabel.Parent = playerBtn

			-- Status indicators
			local statusFrame = Instance.new("Frame")
			statusFrame.Size = UDim2.new(0, 80, 0, 20)
			statusFrame.Position = UDim2.new(1, -90, 0.5, -10)
			statusFrame.BackgroundTransparency = 1
			statusFrame.Parent = playerBtn

			-- Admin indicator
			if isAdmin(p) then
				local adminTag = Instance.new("TextLabel")
				adminTag.Size = UDim2.new(0, 45, 1, 0)
				adminTag.BackgroundColor3 = Color3.fromRGB(255, 180, 0)
				adminTag.Text = "ADMIN"
				adminTag.TextColor3 = Color3.fromRGB(0, 0, 0)
				adminTag.TextSize = 9
				adminTag.Font = Enum.Font.GothamBold
				adminTag.Parent = statusFrame

				local tagCorner = Instance.new("UICorner")
				tagCorner.CornerRadius = UDim.new(0, 3)
				tagCorner.Parent = adminTag

				iconFrame.BackgroundColor3 = Color3.fromRGB(255, 180, 0)
			elseif isSameTeam(player, p) then
				local teamTag = Instance.new("TextLabel")
				teamTag.Size = UDim2.new(0, 45, 1, 0)
				teamTag.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
				teamTag.Text = "TEAM"
				teamTag.TextColor3 = Color3.fromRGB(0, 0, 0)
				teamTag.TextSize = 9
				teamTag.Font = Enum.Font.GothamBold
				teamTag.Parent = statusFrame

				local tagCorner = Instance.new("UICorner")
				tagCorner.CornerRadius = UDim.new(0, 3)
				tagCorner.Parent = teamTag

				iconFrame.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
			elseif p == player then
				local youTag = Instance.new("TextLabel")
				youTag.Size = UDim2.new(0, 35, 1, 0)
				youTag.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
				youTag.Text = "YOU"
				youTag.TextColor3 = Color3.fromRGB(255, 255, 255)
				youTag.TextSize = 9
				youTag.Font = Enum.Font.GothamBold
				youTag.Parent = statusFrame

				local tagCorner = Instance.new("UICorner")
				tagCorner.CornerRadius = UDim.new(0, 3)
				tagCorner.Parent = youTag

				iconFrame.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
			else
				local enemyTag = Instance.new("TextLabel")
				enemyTag.Size = UDim2.new(0, 50, 1, 0)
				enemyTag.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
				enemyTag.Text = "ENEMY"
				enemyTag.TextColor3 = Color3.fromRGB(255, 255, 255)
				enemyTag.TextSize = 9
				enemyTag.Font = Enum.Font.GothamBold
				enemyTag.Parent = statusFrame

				local tagCorner = Instance.new("UICorner")
				tagCorner.CornerRadius = UDim.new(0, 3)
				tagCorner.Parent = enemyTag

				iconFrame.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
			end

			-- Selection indicator
			local selectIndicator = Instance.new("Frame")
			selectIndicator.Name = "SelectIndicator"
			selectIndicator.Size = UDim2.new(0, 3, 0.7, 0)
			selectIndicator.Position = UDim2.new(0, 0, 0.15, 0)
			selectIndicator.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
			selectIndicator.BorderSizePixel = 0
			selectIndicator.Visible = false
			selectIndicator.Parent = playerBtn

			local selectCorner = Instance.new("UICorner")
			selectCorner.CornerRadius = UDim.new(0, 2)
			selectCorner.Parent = selectIndicator

			-- Hover effect
			playerBtn.MouseEnter:Connect(function()
				TweenService:Create(playerBtn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(55, 55, 65)}):Play()
			end)

			playerBtn.MouseLeave:Connect(function()
				if selectedPlayer[player.UserId] ~= p then
					TweenService:Create(playerBtn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(45, 45, 52)}):Play()
				end
			end)

			-- Click to select
			playerBtn.MouseButton1Click:Connect(function()
				-- Deselect previous
				for _, child in ipairs(playerListScroll:GetChildren()) do
					if child:IsA("TextButton") then
						local indicator = child:FindFirstChild("SelectIndicator")
						if indicator then
							indicator.Visible = false
						end
						child.BackgroundColor3 = Color3.fromRGB(45, 45, 52)
					end
				end

				-- Select new
				selectedPlayer[player.UserId] = p
				selectIndicator.Visible = true
				playerBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
				selectedLabel.Text = "Selected: " .. p.Name

				statusLabel.Text = "Selected " .. p.Name
			end)
		end

		playerListScroll.CanvasSize = UDim2.new(0, 0, 0, playerCount * 38)
	end

	-- Update player list initially and on changes
	updatePlayerList()
	Players.PlayerAdded:Connect(updatePlayerList)
	Players.PlayerRemoving:Connect(function(p)
		if selectedPlayer[player.UserId] == p then
			selectedPlayer[player.UserId] = nil
			selectedLabel.Text = "Selected: None"
		end
		task.wait(0.1)
		updatePlayerList()
	end)

	-- ============ LOCAL PLAYER TAB ============
	local localPage = createContentPage("Local Player")
	tabContents["Local Player"] = localPage

	createSectionHeader(localPage, "Character", 0)

	local godModeEnabled = false
	local godModeConnection = nil
	local speedBoostEnabled = false

	createToggleRow(localPage, "God Mode", 30, false, function(enabled)
		godModeEnabled = enabled
		if enabled then
			godModeConnection = RunService.Heartbeat:Connect(function()
				local char = player.Character
				if char then
					local humanoid = char:FindFirstChild("Humanoid")
					if humanoid then
						humanoid.Health = humanoid.MaxHealth
					end
				end
			end)
			statusLabel.Text = "God Mode enabled"
		else
			if godModeConnection then
				godModeConnection:Disconnect()
				godModeConnection = nil
			end
			statusLabel.Text = "God Mode disabled"
		end
	end)

	createToggleRow(localPage, "Speed Boost (100)", 65, false, function(enabled)
		speedBoostEnabled = enabled
		local char = player.Character
		if char then
			local humanoid = char:FindFirstChild("Humanoid")
			if humanoid then
				humanoid.WalkSpeed = enabled and 100 or 16
				statusLabel.Text = enabled and "Speed Boost enabled" or "Speed Boost disabled"
			end
		end
	end)

	createSectionHeader(localPage, "Inventory", 110)

	createButtonRow(localPage, "ðŸ”“ FULL UNLOCK (Items, Currency, Tools)", 140, function()
		local result = fullUnlock(player)
		statusLabel.Text = string.format("Unlocked: %d items, %d stats, %d tools", result.items, result.stats, result.tools)
	end)

	-- ============ VISUALS TAB ============
	local visualsPage = createContentPage("Visuals")
	tabContents["Visuals"] = visualsPage

	createSectionHeader(visualsPage, "ESP Settings", 0)

	createToggleRow(visualsPage, "Enable ESP", 30, false, function(enabled)
		if enabled then
			enableESP(player)
			statusLabel.Text = "ESP enabled (enemies only)"
		else
			clearAllESP(player)
			statusLabel.Text = "ESP disabled"
		end
	end)

	createToggleRow(visualsPage, "Box Outline", 65, true, function(enabled)
		espSettings[player.UserId].boxEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Tracer Lines", 100, true, function(enabled)
		espSettings[player.UserId].tracerEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Player Names", 135, true, function(enabled)
		espSettings[player.UserId].nameEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Health Bars", 170, true, function(enabled)
		espSettings[player.UserId].healthEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Distance Display", 205, true, function(enabled)
		espSettings[player.UserId].distanceEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	-- ============ TRACKING TAB ============
	local trackingPage = createContentPage("Tracking")
	tabContents["Tracking"] = trackingPage

	createSectionHeader(trackingPage, "Tracking Mode", 0)

	createToggleRow(trackingPage, "Hold RMB Mode (vs Click Toggle)", 30, true, function(enabled)
		trackingMode[player.UserId] = enabled and "hold" or "toggle"
		statusLabel.Text = "Mode: " .. (enabled and "Hold RMB" or "Click to Toggle")
	end)

	createSectionHeader(trackingPage, "Tracking Settings", 75)

	createSliderRow(trackingPage, "Sensitivity", 105, 0.01, 0.5, 0.15, function(value)
		trackingSettings[player.UserId].sensitivity = value
	end)

	createSliderRow(trackingPage, "Max Range (studs)", 160, 50, 1000, 500, function(value)
		trackingSettings[player.UserId].maxRange = value
	end)

	createToggleRow(trackingPage, "Require Line of Sight", 220, true, function(enabled)
		trackingSettings[player.UserId].requireLineOfSight = enabled
	end)

	createSectionHeader(trackingPage, "Manual Control", 265)

	createButtonRow(trackingPage, "Stop All Tracking", 295, function()
		stopTracking(player)
		stopRightMouseTracking(player)
		toggleTrackingActive[player.UserId] = false
		statusLabel.Text = "All tracking stopped"
	end)

	-- ============ COMMANDS TAB ============
	local commandsPage = createContentPage("Commands")
	tabContents["Commands"] = commandsPage

	createSectionHeader(commandsPage, "Server", 0)

	createButtonRow(commandsPage, "Rejoin Server", 30, function()
		TeleportService:Teleport(game.PlaceId, player)
	end)

	createButtonRow(commandsPage, "Print Server Info", 67, function()
		print("=== SERVER INFO ===")
		print("Place ID: " .. game.PlaceId)
		print("Job ID: " .. game.JobId)
		print("Players: " .. #Players:GetPlayers())
		statusLabel.Text = "Server info printed to console"
	end)

	createSectionHeader(commandsPage, "Locate", 115)

	createButtonRow(commandsPage, "Locate All Enemies", 145, function()
		local count = 0
		print("=== ENEMY LOCATIONS ===")
		for _, p in ipairs(Players:GetPlayers()) do
			if isValidTarget(player, p) then
				local char = p.Character
				if char then
					local hrp = char:FindFirstChild("HumanoidRootPart")
					if hrp then
						count = count + 1
						local canSee = hasLineOfSight(player, p)
						print(string.format("%s %s: X:%.0f Y:%.0f Z:%.0f", canSee and "â—‰" or "â—Ž", p.Name, hrp.Position.X, hrp.Position.Y, hrp.Position.Z))
					end
				end
			end
		end
		statusLabel.Text = "Located " .. count .. " enemies"
	end)

	-- ============ SETTINGS TAB ============
	local settingsPage = createContentPage("Settings")
	tabContents["Settings"] = settingsPage

	createSectionHeader(settingsPage, "UI", 0)

	local uiInfo = Instance.new("TextLabel")
	uiInfo.Size = UDim2.new(1, -10, 0, 60)
	uiInfo.Position = UDim2.new(0, 5, 0, 30)
	uiInfo.BackgroundTransparency = 1
	uiInfo.Text = "More settings coming soon...\n\nPress Right Ctrl to toggle this panel\nmade by bixix"
	uiInfo.TextColor3 = Color3.fromRGB(120, 120, 130)
	uiInfo.TextSize = 12
	uiInfo.Font = Enum.Font.Gotham
	uiInfo.TextXAlignment = Enum.TextXAlignment.Left
	uiInfo.TextWrapped = true
	uiInfo.Parent = settingsPage

	-- Tab switching
	local function switchTab(tabName)
		currentTab[player.UserId] = tabName

		for name, data in pairs(tabButtons) do
			if name == tabName then
				data.button.BackgroundTransparency = 0
				data.button.BackgroundColor3 = Color3.fromRGB(30, 30, 38)
				data.indicator.Visible = true
				data.label.TextColor3 = Color3.fromRGB(255, 255, 255)
			else
				data.button.BackgroundTransparency = 1
				data.indicator.Visible = false
				data.label.TextColor3 = Color3.fromRGB(180, 180, 185)
			end
		end

		for name, content in pairs(tabContents) do
			content.Visible = (name == tabName)
		end

		-- Update player list when switching to Players tab
		if tabName == "Players" then
			updatePlayerList()
		end
	end

	for name, data in pairs(tabButtons) do
		data.button.MouseButton1Click:Connect(function()
			switchTab(name)
		end)

		data.button.MouseEnter:Connect(function()
			if currentTab[player.UserId] ~= name then
				TweenService:Create(data.button, TweenInfo.new(0.1), {BackgroundTransparency = 0.5}):Play()
			end
		end)

		data.button.MouseLeave:Connect(function()
			if currentTab[player.UserId] ~= name then
				TweenService:Create(data.button, TweenInfo.new(0.1), {BackgroundTransparency = 1}):Play()
			end
		end)
	end

	switchTab("Information")

	-- Improved RMB Tracking
	local rmbConnection = nil

	local function startRMBTracking()
		stopRightMouseTracking(player)

		local settings = trackingSettings[player.UserId]
		local nearestPlayer, distance = getNearestValidTarget(player, settings.maxRange)

		if not nearestPlayer then
			statusLabel.Text = "No valid targets in range"
			return
		end

		statusLabel.Text = "Tracking: " .. nearestPlayer.Name

		local camera = Workspace.CurrentCamera

		local connection = RunService.RenderStepped:Connect(function()
			if not isRMBHeld[player.UserId] and trackingMode[player.UserId] == "hold" then
				return
			end

			local currentSettings = trackingSettings[player.UserId]
			local currentNearest, dist = getNearestValidTarget(player, currentSettings.maxRange)

			if not currentNearest then
				statusLabel.Text = "No targets in range"
				return
			end

			local adminChar = player.Character
			local targetChar = currentNearest.Character

			if not adminChar or not targetChar then return end

			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if targetHRP and camera then
				local lookAtCFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position)
				camera.CFrame = camera.CFrame:Lerp(lookAtCFrame, currentSettings.sensitivity)
				statusLabel.Text = string.format("Tracking: %s (%.0fm)", currentNearest.Name, dist)
			end
		end)

		rightMouseTracking[player.UserId] = {
			connection = connection
		}
	end

	local function stopRMBTrackingUI()
		stopRightMouseTracking(player)
		if not activeTracking[player.UserId] then
			statusLabel.Text = "Ready â€¢ Right Ctrl to toggle"
		end
	end

	-- Input handling with improved RMB detection
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end

		if input.KeyCode == Enum.KeyCode.RightControl then
			mainFrame.Visible = not mainFrame.Visible
		end

		if input.UserInputType == Enum.UserInputType.MouseButton2 then
			isRMBHeld[player.UserId] = true

			if trackingMode[player.UserId] == "hold" then
				startRMBTracking()
			else
				if toggleTrackingActive[player.UserId] then
					toggleTrackingActive[player.UserId] = false
					stopRMBTrackingUI()
				else
					toggleTrackingActive[player.UserId] = true
					startRMBTracking()
				end
			end
		end
	end)

	UserInputService.InputEnded:Connect(function(input, gameProcessed)
		if input.UserInputType == Enum.UserInputType.MouseButton2 then
			isRMBHeld[player.UserId] = false

			if trackingMode[player.UserId] == "hold" then
				stopRMBTrackingUI()
			end
		end
	end)

	-- Additional RMB check loop for reliability
	RunService.Heartbeat:Connect(function()
		if trackingMode[player.UserId] == "hold" then
			local isPressed = UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)

			if isPressed and not isRMBHeld[player.UserId] then
				isRMBHeld[player.UserId] = true
				if not rightMouseTracking[player.UserId] then
					startRMBTracking()
				end
			elseif not isPressed and isRMBHeld[player.UserId] then
				isRMBHeld[player.UserId] = false
				stopRMBTrackingUI()
			end
		end
	end)

	-- Close button
	closeBtn.MouseButton1Click:Connect(function()
		mainFrame.Visible = false
	end)

	closeBtn.MouseEnter:Connect(function()
		closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
	end)

	closeBtn.MouseLeave:Connect(function()
		closeBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
	end)
end

-- Give GUI to admins
Players.PlayerAdded:Connect(function(player)
	if isAdmin(player) then
		createAdminGui(player)
	end
end)

-- For admins already in game
for _, player in ipairs(Players:GetPlayers()) do
	if isAdmin(player) then
		createAdminGui(player)
	end
end
