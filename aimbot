-- ServerScriptService

-- Services
local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")
local SoundService = game:GetService("SoundService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local TeleportService = game:GetService("TeleportService")
local BadgeService = game:GetService("BadgeService")
local DataStoreService = game:GetService("DataStoreService")
local PhysicsService = game:GetService("PhysicsService")
local PathfindingService = game:GetService("PathfindingService")
local Chat = game:GetService("Chat")
local Teams = game:GetService("Teams")
local StarterGui = game:GetService("StarterGui")
local StarterPack = game:GetService("StarterPack")
local StarterPlayer = game:GetService("StarterPlayer")
local ContextActionService = game:GetService("ContextActionService")
local CoreGui = game:GetService("CoreGui")

local adminIds = {
	9766385891,
}

local activeTracking = {}
local activeESP = {}
local espEnabled = {}
local rightMouseTracking = {}
local espSettings = {}
local trackingMode = {}
local toggleTrackingActive = {}
local currentTab = {}

local function isAdmin(player)
	for _, id in ipairs(adminIds) do
		if player.UserId == id then
			return true
		end
	end
	return false
end

local function isSameTeam(player1, player2)
	if not player1.Team or not player2.Team then
		return false
	end
	return player1.Team == player2.Team
end

local function isValidTarget(admin, target)
	if target == admin then
		return false
	end

	if isAdmin(target) then
		return false
	end

	if isSameTeam(admin, target) then
		return false
	end

	return true
end

local function hasLineOfSight(admin, target)
	local adminChar = admin.Character
	local targetChar = target.Character

	if not adminChar or not targetChar then
		return false
	end

	local adminHead = adminChar:FindFirstChild("Head")
	local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

	if not adminHead or not targetHRP then
		return false
	end

	local origin = adminHead.Position
	local destination = targetHRP.Position
	local direction = (destination - origin)
	local distance = direction.Magnitude

	local raycastParams = RaycastParams.new()
	raycastParams.FilterType = Enum.RaycastFilterType.Exclude
	raycastParams.FilterDescendantsInstances = {adminChar, targetChar}
	raycastParams.IgnoreWater = true

	local raycastResult = Workspace:Raycast(origin, direction.Unit * distance, raycastParams)

	if raycastResult then
		return false
	end

	return true
end

local function findPlayer(name)
	name = name:lower()
	for _, player in ipairs(Players:GetPlayers()) do
		if player.Name:lower():sub(1, #name) == name then
			return player
		end
	end
	return nil
end

local function getNearestValidTarget(admin)
	local adminChar = admin.Character
	if not adminChar then return nil end

	local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
	if not adminHRP then return nil end

	local nearestPlayer = nil
	local nearestDistance = math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if isValidTarget(admin, player) then
			local char = player.Character
			if char then
				local hrp = char:FindFirstChild("HumanoidRootPart")
				if hrp then
					local distance = (adminHRP.Position - hrp.Position).Magnitude

					if distance < nearestDistance and hasLineOfSight(admin, player) then
						nearestDistance = distance
						nearestPlayer = player
					end
				end
			end
		end
	end

	return nearestPlayer, nearestDistance
end

local function stopTracking(admin)
	if activeTracking[admin.UserId] then
		if activeTracking[admin.UserId].connection then
			activeTracking[admin.UserId].connection:Disconnect()
		end
		activeTracking[admin.UserId] = nil
		return true
	end
	return false
end

local function stopRightMouseTracking(admin)
	if rightMouseTracking[admin.UserId] then
		if rightMouseTracking[admin.UserId].connection then
			rightMouseTracking[admin.UserId].connection:Disconnect()
		end
		rightMouseTracking[admin.UserId] = nil

		local camera = Workspace.CurrentCamera
		if camera then
			camera.CameraType = Enum.CameraType.Custom
		end
		return true
	end
	return false
end

-- Compact ESP with small box outline
local function createCompactESP(target, admin)
	if not target.Character then return nil end

	if not isValidTarget(admin, target) then
		return nil
	end

	local existingFolder = target.Character:FindFirstChild("AdminESP_" .. admin.UserId)
	if existingFolder then
		existingFolder:Destroy()
	end

	local espFolder = Instance.new("Folder")
	espFolder.Name = "AdminESP_" .. admin.UserId
	espFolder.Parent = target.Character

	local settings = espSettings[admin.UserId] or {
		boxEnabled = true,
		tracerEnabled = true,
		nameEnabled = true,
		healthEnabled = true,
		distanceEnabled = true
	}

	-- Small Billboard for compact info
	local billboardGui = Instance.new("BillboardGui")
	billboardGui.Name = "InfoBoard"
	billboardGui.Adornee = target.Character:FindFirstChild("Head")
	billboardGui.Size = UDim2.new(0, 120, 0, 45)
	billboardGui.StudsOffset = Vector3.new(0, 2, 0)
	billboardGui.AlwaysOnTop = true
	billboardGui.Parent = espFolder

	local infoFrame = Instance.new("Frame")
	infoFrame.Size = UDim2.new(1, 0, 1, 0)
	infoFrame.BackgroundTransparency = 1
	infoFrame.Parent = billboardGui

	-- Name Label (smaller)
	local nameLabel = Instance.new("TextLabel")
	nameLabel.Name = "NameLabel"
	nameLabel.Size = UDim2.new(1, 0, 0, 14)
	nameLabel.Position = UDim2.new(0, 0, 0, 0)
	nameLabel.BackgroundTransparency = 1
	nameLabel.Text = target.Name
	nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	nameLabel.TextStrokeTransparency = 0
	nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	nameLabel.TextSize = 11
	nameLabel.Font = Enum.Font.GothamBold
	nameLabel.Visible = settings.nameEnabled
	nameLabel.Parent = infoFrame

	-- Health Bar (thin)
	local healthBarBg = Instance.new("Frame")
	healthBarBg.Name = "HealthBarBg"
	healthBarBg.Size = UDim2.new(0.7, 0, 0, 3)
	healthBarBg.Position = UDim2.new(0.15, 0, 0, 16)
	healthBarBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	healthBarBg.BorderSizePixel = 0
	healthBarBg.Visible = settings.healthEnabled
	healthBarBg.Parent = infoFrame

	local healthBarFill = Instance.new("Frame")
	healthBarFill.Name = "HealthBarFill"
	healthBarFill.Size = UDim2.new(1, 0, 1, 0)
	healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	healthBarFill.BorderSizePixel = 0
	healthBarFill.Parent = healthBarBg

	-- Distance Label (smaller)
	local distanceLabel = Instance.new("TextLabel")
	distanceLabel.Name = "DistanceLabel"
	distanceLabel.Size = UDim2.new(1, 0, 0, 12)
	distanceLabel.Position = UDim2.new(0, 0, 0, 21)
	distanceLabel.BackgroundTransparency = 1
	distanceLabel.Text = "0m"
	distanceLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
	distanceLabel.TextStrokeTransparency = 0
	distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
	distanceLabel.TextSize = 10
	distanceLabel.Font = Enum.Font.Gotham
	distanceLabel.Visible = settings.distanceEnabled
	distanceLabel.Parent = infoFrame

	-- Visibility indicator (small dot)
	local visibilityDot = Instance.new("Frame")
	visibilityDot.Name = "VisibilityDot"
	visibilityDot.Size = UDim2.new(0, 6, 0, 6)
	visibilityDot.Position = UDim2.new(0.5, -3, 0, 35)
	visibilityDot.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
	visibilityDot.BorderSizePixel = 0
	visibilityDot.Parent = infoFrame

	local dotCorner = Instance.new("UICorner")
	dotCorner.CornerRadius = UDim.new(1, 0)
	dotCorner.Parent = visibilityDot

	-- Thin outline highlight (not filled)
	local highlight = Instance.new("Highlight")
	highlight.Name = "BoxHighlight"
	highlight.Adornee = target.Character
	highlight.FillColor = Color3.fromRGB(255, 0, 0)
	highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
	highlight.FillTransparency = 1 -- No fill, outline only
	highlight.OutlineTransparency = 0
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.Enabled = settings.boxEnabled
	highlight.Parent = espFolder

	-- Tracer (thinner)
	local tracerPart = Instance.new("Part")
	tracerPart.Name = "TracerAnchor"
	tracerPart.Anchored = true
	tracerPart.CanCollide = false
	tracerPart.Transparency = 1
	tracerPart.Size = Vector3.new(0.1, 0.1, 0.1)
	tracerPart.Parent = espFolder

	local beam = Instance.new("Beam")
	beam.Name = "Tracer"
	beam.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0))
	beam.Transparency = NumberSequence.new(0.5)
	beam.Width0 = 0.05
	beam.Width1 = 0.05
	beam.FaceCamera = true
	beam.Enabled = settings.tracerEnabled
	beam.Parent = espFolder

	local attachment0 = Instance.new("Attachment")
	attachment0.Name = "TracerStart"
	attachment0.Parent = tracerPart

	local attachment1 = Instance.new("Attachment")
	attachment1.Name = "TracerEnd"
	attachment1.Parent = tracerPart

	beam.Attachment0 = attachment0
	beam.Attachment1 = attachment1

	return {
		folder = espFolder,
		highlight = highlight,
		billboard = billboardGui,
		nameLabel = nameLabel,
		healthBarBg = healthBarBg,
		healthBarFill = healthBarFill,
		distanceLabel = distanceLabel,
		visibilityDot = visibilityDot,
		beam = beam,
		tracerPart = tracerPart,
		attachment0 = attachment0,
		attachment1 = attachment1
	}
end

local function updateCompactESP(admin, target, espComponents)
	if not admin.Character or not target.Character then return false end

	if not isValidTarget(admin, target) then
		if espComponents.folder then
			espComponents.folder:Destroy()
		end
		return false
	end

	local adminHRP = admin.Character:FindFirstChild("HumanoidRootPart")
	local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
	local targetHumanoid = target.Character:FindFirstChild("Humanoid")

	if not adminHRP or not targetHRP then return true end

	local distance = (adminHRP.Position - targetHRP.Position).Magnitude
	local canSee = hasLineOfSight(admin, target)

	-- Update distance
	if espComponents.distanceLabel then
		espComponents.distanceLabel.Text = string.format("%.0fm", distance)
	end

	-- Update health bar
	if targetHumanoid and espComponents.healthBarFill then
		local healthPercent = targetHumanoid.Health / targetHumanoid.MaxHealth
		espComponents.healthBarFill.Size = UDim2.new(healthPercent, 0, 1, 0)

		if healthPercent > 0.6 then
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		elseif healthPercent > 0.3 then
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
		else
			espComponents.healthBarFill.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		end
	end

	-- Update visibility dot
	if espComponents.visibilityDot then
		if canSee then
			espComponents.visibilityDot.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		else
			espComponents.visibilityDot.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
		end
	end

	-- Update colors based on distance
	local espColor
	if distance < 30 then
		espColor = Color3.fromRGB(255, 50, 50)
	elseif distance < 75 then
		espColor = Color3.fromRGB(255, 165, 0)
	elseif distance < 150 then
		espColor = Color3.fromRGB(255, 255, 0)
	else
		espColor = Color3.fromRGB(0, 255, 0)
	end

	if espComponents.highlight then
		espComponents.highlight.OutlineColor = espColor
		espComponents.highlight.FillTransparency = canSee and 0.9 or 1
	end

	-- Update tracer
	if espComponents.beam and espComponents.tracerPart then
		local camera = Workspace.CurrentCamera
		if camera then
			espComponents.tracerPart.Position = camera.CFrame.Position
			espComponents.attachment0.WorldPosition = camera.CFrame.Position + Vector3.new(0, -1.5, 0)
			espComponents.attachment1.WorldPosition = targetHRP.Position
			espComponents.beam.Color = ColorSequence.new(espColor)
		end
	end

	return true
end

local function clearAllESP(admin)
	if activeESP[admin.UserId] then
		for _, data in pairs(activeESP[admin.UserId]) do
			if data.connection then
				data.connection:Disconnect()
			end
			if data.components and data.components.folder then
				data.components.folder:Destroy()
			end
		end
		activeESP[admin.UserId] = nil
	end

	for _, player in ipairs(Players:GetPlayers()) do
		if player.Character then
			local folder = player.Character:FindFirstChild("AdminESP_" .. admin.UserId)
			if folder then
				folder:Destroy()
			end
		end
	end

	espEnabled[admin.UserId] = false
end

local function enableESP(admin)
	clearAllESP(admin)

	activeESP[admin.UserId] = {}
	espEnabled[admin.UserId] = true

	for _, target in ipairs(Players:GetPlayers()) do
		if isValidTarget(admin, target) then
			local components = createCompactESP(target, admin)
			if components then
				local connection = RunService.Heartbeat:Connect(function()
					if not espEnabled[admin.UserId] then
						return
					end
					local stillValid = updateCompactESP(admin, target, components)
					if not stillValid then
						if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
							activeESP[admin.UserId][target.UserId].connection:Disconnect()
							activeESP[admin.UserId][target.UserId] = nil
						end
					end
				end)

				activeESP[admin.UserId][target.UserId] = {
					components = components,
					connection = connection
				}
			end
		end
	end

	-- Handle new players
	local playerAddedConn
	playerAddedConn = Players.PlayerAdded:Connect(function(target)
		if not espEnabled[admin.UserId] then
			playerAddedConn:Disconnect()
			return
		end

		target.CharacterAdded:Wait()
		task.wait(1)

		if espEnabled[admin.UserId] and isValidTarget(admin, target) then
			local components = createCompactESP(target, admin)
			if components then
				local connection = RunService.Heartbeat:Connect(function()
					if not espEnabled[admin.UserId] then
						return
					end
					updateCompactESP(admin, target, components)
				end)

				if not activeESP[admin.UserId] then
					activeESP[admin.UserId] = {}
				end

				activeESP[admin.UserId][target.UserId] = {
					components = components,
					connection = connection
				}
			end
		end
	end)

	-- Handle respawns and team changes
	for _, target in ipairs(Players:GetPlayers()) do
		if target ~= admin then
			target.CharacterAdded:Connect(function()
				if espEnabled[admin.UserId] and isValidTarget(admin, target) then
					task.wait(1)

					if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
						if activeESP[admin.UserId][target.UserId].connection then
							activeESP[admin.UserId][target.UserId].connection:Disconnect()
						end
						if activeESP[admin.UserId][target.UserId].components and activeESP[admin.UserId][target.UserId].components.folder then
							activeESP[admin.UserId][target.UserId].components.folder:Destroy()
						end
					end

					local components = createCompactESP(target, admin)
					if components then
						local connection = RunService.Heartbeat:Connect(function()
							if not espEnabled[admin.UserId] then
								return
							end
							updateCompactESP(admin, target, components)
						end)

						if not activeESP[admin.UserId] then
							activeESP[admin.UserId] = {}
						end

						activeESP[admin.UserId][target.UserId] = {
							components = components,
							connection = connection
						}
					end
				end
			end)

			target:GetPropertyChangedSignal("Team"):Connect(function()
				if espEnabled[admin.UserId] then
					if not isValidTarget(admin, target) then
						if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
							if activeESP[admin.UserId][target.UserId].connection then
								activeESP[admin.UserId][target.UserId].connection:Disconnect()
							end
							if activeESP[admin.UserId][target.UserId].components and activeESP[admin.UserId][target.UserId].components.folder then
								activeESP[admin.UserId][target.UserId].components.folder:Destroy()
							end
							activeESP[admin.UserId][target.UserId] = nil
						end
					else
						if (not activeESP[admin.UserId] or not activeESP[admin.UserId][target.UserId]) and target.Character then
							local components = createCompactESP(target, admin)
							if components then
								local connection = RunService.Heartbeat:Connect(function()
									if not espEnabled[admin.UserId] then
										return
									end
									updateCompactESP(admin, target, components)
								end)

								if not activeESP[admin.UserId] then
									activeESP[admin.UserId] = {}
								end

								activeESP[admin.UserId][target.UserId] = {
									components = components,
									connection = connection
								}
							end
						end
					end
				end
			end)
		end
	end
end

local function createAdminGui(player)
	-- Initialize settings
	espSettings[player.UserId] = {
		boxEnabled = true,
		tracerEnabled = true,
		nameEnabled = true,
		healthEnabled = true,
		distanceEnabled = true
	}
	trackingMode[player.UserId] = "hold"
	toggleTrackingActive[player.UserId] = false
	currentTab[player.UserId] = "Information"

	-- Main ScreenGui
	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "AdminPanel"
	screenGui.ResetOnSpawn = false
	screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	screenGui.Parent = player:WaitForChild("PlayerGui")

	-- Main Container (wider like Phantasm)
	local mainFrame = Instance.new("Frame")
	mainFrame.Name = "MainFrame"
	mainFrame.Size = UDim2.new(0, 650, 0, 450)
	mainFrame.Position = UDim2.new(0.5, -325, 0.5, -225)
	mainFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
	mainFrame.BorderSizePixel = 0
	mainFrame.Visible = false
	mainFrame.Active = true
	mainFrame.Draggable = true
	mainFrame.Parent = screenGui

	local mainCorner = Instance.new("UICorner")
	mainCorner.CornerRadius = UDim.new(0, 6)
	mainCorner.Parent = mainFrame

	-- Header
	local header = Instance.new("Frame")
	header.Name = "Header"
	header.Size = UDim2.new(1, 0, 0, 45)
	header.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
	header.BorderSizePixel = 0
	header.Parent = mainFrame

	local headerCorner = Instance.new("UICorner")
	headerCorner.CornerRadius = UDim.new(0, 6)
	headerCorner.Parent = header

	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(0, 200, 1, 0)
	titleLabel.Position = UDim2.new(0.5, -100, 0, 0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "Admin Panel"
	titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleLabel.TextSize = 18
	titleLabel.Font = Enum.Font.GothamBold
	titleLabel.Parent = header

	-- Search Bar
	local searchFrame = Instance.new("Frame")
	searchFrame.Size = UDim2.new(0, 250, 0, 28)
	searchFrame.Position = UDim2.new(1, -310, 0.5, -14)
	searchFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
	searchFrame.BorderSizePixel = 0
	searchFrame.Parent = header

	local searchCorner = Instance.new("UICorner")
	searchCorner.CornerRadius = UDim.new(0, 4)
	searchCorner.Parent = searchFrame

	local searchIcon = Instance.new("TextLabel")
	searchIcon.Size = UDim2.new(0, 28, 1, 0)
	searchIcon.BackgroundTransparency = 1
	searchIcon.Text = "ðŸ”"
	searchIcon.TextColor3 = Color3.fromRGB(100, 100, 110)
	searchIcon.TextSize = 12
	searchIcon.Font = Enum.Font.Gotham
	searchIcon.Parent = searchFrame

	local searchBox = Instance.new("TextBox")
	searchBox.Name = "SearchBox"
	searchBox.Size = UDim2.new(1, -35, 1, 0)
	searchBox.Position = UDim2.new(0, 28, 0, 0)
	searchBox.BackgroundTransparency = 1
	searchBox.Text = ""
	searchBox.PlaceholderText = "Search"
	searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	searchBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 110)
	searchBox.TextSize = 12
	searchBox.Font = Enum.Font.Gotham
	searchBox.TextXAlignment = Enum.TextXAlignment.Left
	searchBox.ClearTextOnFocus = false
	searchBox.Parent = searchFrame

	-- Close/Minimize buttons
	local closeBtn = Instance.new("TextButton")
	closeBtn.Size = UDim2.new(0, 20, 0, 20)
	closeBtn.Position = UDim2.new(1, -30, 0.5, -10)
	closeBtn.BackgroundTransparency = 1
	closeBtn.Text = "+"
	closeBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
	closeBtn.TextSize = 20
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.Rotation = 45
	closeBtn.Parent = header

	-- Sidebar
	local sidebar = Instance.new("Frame")
	sidebar.Name = "Sidebar"
	sidebar.Size = UDim2.new(0, 180, 1, -45)
	sidebar.Position = UDim2.new(0, 0, 0, 45)
	sidebar.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
	sidebar.BorderSizePixel = 0
	sidebar.Parent = mainFrame

	local sidebarLine = Instance.new("Frame")
	sidebarLine.Size = UDim2.new(0, 1, 1, 0)
	sidebarLine.Position = UDim2.new(1, 0, 0, 0)
	sidebarLine.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
	sidebarLine.BorderSizePixel = 0
	sidebarLine.Parent = sidebar

	-- Tab buttons data
	local tabs = {
		{name = "Information", icon = "ðŸ“‹", color = Color3.fromRGB(88, 101, 242)},
		{name = "Local Player", icon = "ðŸ‘¤", color = Color3.fromRGB(88, 101, 242)},
		{name = "Visuals", icon = "ðŸ‘", color = Color3.fromRGB(88, 101, 242)},
		{name = "Commands", icon = "â—‡", color = Color3.fromRGB(88, 101, 242)},
		{name = "Map", icon = "ðŸ—º", color = Color3.fromRGB(88, 101, 242)},
		{name = "Tracking", icon = "ðŸŽ¯", color = Color3.fromRGB(88, 101, 242)},
		{name = "Miscellaneous", icon = "â€¢â€¢â€¢", color = Color3.fromRGB(88, 101, 242)},
		{name = "UI Settings", icon = "âš™", color = Color3.fromRGB(88, 101, 242)},
	}

	local tabButtons = {}
	local tabContents = {}

	-- Create sidebar buttons
	for i, tab in ipairs(tabs) do
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = tab.name .. "Tab"
		tabBtn.Size = UDim2.new(1, -10, 0, 35)
		tabBtn.Position = UDim2.new(0, 5, 0, 10 + (i - 1) * 40)
		tabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
		tabBtn.BackgroundTransparency = 1
		tabBtn.BorderSizePixel = 0
		tabBtn.Text = ""
		tabBtn.AutoButtonColor = false
		tabBtn.Parent = sidebar

		local tabCorner = Instance.new("UICorner")
		tabCorner.CornerRadius = UDim.new(0, 4)
		tabCorner.Parent = tabBtn

		local tabIcon = Instance.new("TextLabel")
		tabIcon.Size = UDim2.new(0, 30, 1, 0)
		tabIcon.Position = UDim2.new(0, 8, 0, 0)
		tabIcon.BackgroundTransparency = 1
		tabIcon.Text = tab.icon
		tabIcon.TextColor3 = Color3.fromRGB(150, 150, 160)
		tabIcon.TextSize = 14
		tabIcon.Font = Enum.Font.Gotham
		tabIcon.Parent = tabBtn

		local tabLabel = Instance.new("TextLabel")
		tabLabel.Size = UDim2.new(1, -45, 1, 0)
		tabLabel.Position = UDim2.new(0, 40, 0, 0)
		tabLabel.BackgroundTransparency = 1
		tabLabel.Text = tab.name
		tabLabel.TextColor3 = Color3.fromRGB(180, 180, 185)
		tabLabel.TextSize = 13
		tabLabel.Font = Enum.Font.Gotham
		tabLabel.TextXAlignment = Enum.TextXAlignment.Left
		tabLabel.Parent = tabBtn

		local activeIndicator = Instance.new("Frame")
		activeIndicator.Name = "Indicator"
		activeIndicator.Size = UDim2.new(0, 3, 0.6, 0)
		activeIndicator.Position = UDim2.new(0, 0, 0.2, 0)
		activeIndicator.BackgroundColor3 = tab.color
		activeIndicator.BorderSizePixel = 0
		activeIndicator.Visible = false
		activeIndicator.Parent = tabBtn

		local indicatorCorner = Instance.new("UICorner")
		indicatorCorner.CornerRadius = UDim.new(0, 2)
		indicatorCorner.Parent = activeIndicator

		tabButtons[tab.name] = {button = tabBtn, icon = tabIcon, label = tabLabel, indicator = activeIndicator}
	end

	-- Content Area
	local contentArea = Instance.new("Frame")
	contentArea.Name = "ContentArea"
	contentArea.Size = UDim2.new(1, -180, 1, -45)
	contentArea.Position = UDim2.new(0, 180, 0, 45)
	contentArea.BackgroundColor3 = Color3.fromRGB(28, 28, 32)
	contentArea.BorderSizePixel = 0
	contentArea.Parent = mainFrame

	-- Create content pages for each tab
	local function createContentPage(name)
		local page = Instance.new("ScrollingFrame")
		page.Name = name .. "Content"
		page.Size = UDim2.new(1, -20, 1, -20)
		page.Position = UDim2.new(0, 10, 0, 10)
		page.BackgroundTransparency = 1
		page.ScrollBarThickness = 3
		page.ScrollBarImageColor3 = Color3.fromRGB(88, 101, 242)
		page.CanvasSize = UDim2.new(0, 0, 0, 500)
		page.Visible = false
		page.Parent = contentArea
		return page
	end

	-- Toggle function for settings
	local function createToggleRow(parent, text, posY, default, callback)
		local row = Instance.new("Frame")
		row.Size = UDim2.new(1, 0, 0, 32)
		row.Position = UDim2.new(0, 0, 0, posY)
		row.BackgroundTransparency = 1
		row.Parent = parent

		local label = Instance.new("TextLabel")
		label.Size = UDim2.new(1, -60, 1, 0)
		label.Position = UDim2.new(0, 5, 0, 0)
		label.BackgroundTransparency = 1
		label.Text = text
		label.TextColor3 = Color3.fromRGB(180, 180, 185)
		label.TextSize = 12
		label.Font = Enum.Font.Gotham
		label.TextXAlignment = Enum.TextXAlignment.Left
		label.Parent = row

		local toggleBg = Instance.new("Frame")
		toggleBg.Size = UDim2.new(0, 38, 0, 18)
		toggleBg.Position = UDim2.new(1, -45, 0.5, -9)
		toggleBg.BackgroundColor3 = default and Color3.fromRGB(88, 101, 242) or Color3.fromRGB(50, 50, 55)
		toggleBg.BorderSizePixel = 0
		toggleBg.Parent = row

		local toggleCorner = Instance.new("UICorner")
		toggleCorner.CornerRadius = UDim.new(1, 0)
		toggleCorner.Parent = toggleBg

		local toggleCircle = Instance.new("Frame")
		toggleCircle.Size = UDim2.new(0, 14, 0, 14)
		toggleCircle.Position = default and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
		toggleCircle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
		toggleCircle.BorderSizePixel = 0
		toggleCircle.Parent = toggleBg

		local circleCorner = Instance.new("UICorner")
		circleCorner.CornerRadius = UDim.new(1, 0)
		circleCorner.Parent = toggleCircle

		local isEnabled = default

		local toggleBtn = Instance.new("TextButton")
		toggleBtn.Size = UDim2.new(1, 0, 1, 0)
		toggleBtn.BackgroundTransparency = 1
		toggleBtn.Text = ""
		toggleBtn.Parent = row

		toggleBtn.MouseButton1Click:Connect(function()
			isEnabled = not isEnabled

			if isEnabled then
				TweenService:Create(toggleBg, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(88, 101, 242)}):Play()
				TweenService:Create(toggleCircle, TweenInfo.new(0.15), {Position = UDim2.new(1, -16, 0.5, -7)}):Play()
			else
				TweenService:Create(toggleBg, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
				TweenService:Create(toggleCircle, TweenInfo.new(0.15), {Position = UDim2.new(0, 2, 0.5, -7)}):Play()
			end

			callback(isEnabled)
		end)

		return row
	end

	-- Button row function
	local function createButtonRow(parent, text, posY, callback)
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1, -10, 0, 32)
		btn.Position = UDim2.new(0, 5, 0, posY)
		btn.BackgroundColor3 = Color3.fromRGB(40, 40, 48)
		btn.BorderSizePixel = 0
		btn.Text = ""
		btn.AutoButtonColor = false
		btn.Parent = parent

		local btnCorner = Instance.new("UICorner")
		btnCorner.CornerRadius = UDim.new(0, 4)
		btnCorner.Parent = btn

		local btnLabel = Instance.new("TextLabel")
		btnLabel.Size = UDim2.new(1, -10, 1, 0)
		btnLabel.Position = UDim2.new(0, 10, 0, 0)
		btnLabel.BackgroundTransparency = 1
		btnLabel.Text = text
		btnLabel.TextColor3 = Color3.fromRGB(200, 200, 205)
		btnLabel.TextSize = 12
		btnLabel.Font = Enum.Font.Gotham
		btnLabel.TextXAlignment = Enum.TextXAlignment.Left
		btnLabel.Parent = btn

		btn.MouseEnter:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
		end)

		btn.MouseLeave:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(40, 40, 48)}):Play()
		end)

		btn.MouseButton1Click:Connect(callback)

		return btn, btnLabel
	end

	-- Section header function
	local function createSectionHeader(parent, text, posY)
		local header = Instance.new("TextLabel")
		header.Size = UDim2.new(1, 0, 0, 25)
		header.Position = UDim2.new(0, 5, 0, posY)
		header.BackgroundTransparency = 1
		header.Text = text
		header.TextColor3 = Color3.fromRGB(120, 120, 130)
		header.TextSize = 11
		header.Font = Enum.Font.GothamBold
		header.TextXAlignment = Enum.TextXAlignment.Left
		header.Parent = parent
		return header
	end

	-- Input row function
	local function createInputRow(parent, placeholder, posY)
		local inputFrame = Instance.new("Frame")
		inputFrame.Size = UDim2.new(1, -10, 0, 32)
		inputFrame.Position = UDim2.new(0, 5, 0, posY)
		inputFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
		inputFrame.BorderSizePixel = 0
		inputFrame.Parent = parent

		local inputCorner = Instance.new("UICorner")
		inputCorner.CornerRadius = UDim.new(0, 4)
		inputCorner.Parent = inputFrame

		local textBox = Instance.new("TextBox")
		textBox.Size = UDim2.new(1, -15, 1, 0)
		textBox.Position = UDim2.new(0, 10, 0, 0)
		textBox.BackgroundTransparency = 1
		textBox.Text = ""
		textBox.PlaceholderText = placeholder
		textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
		textBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 110)
		textBox.TextSize = 12
		textBox.Font = Enum.Font.Gotham
		textBox.TextXAlignment = Enum.TextXAlignment.Left
		textBox.ClearTextOnFocus = false
		textBox.Parent = inputFrame

		return inputFrame, textBox
	end

	-- Status label
	local statusLabel = Instance.new("TextLabel")
	statusLabel.Name = "StatusLabel"
	statusLabel.Size = UDim2.new(1, 0, 0, 20)
	statusLabel.Position = UDim2.new(0, 0, 1, -25)
	statusLabel.BackgroundTransparency = 1
	statusLabel.Text = "Ready â€¢ Right Ctrl to toggle | discord.gg/adminpanel"
	statusLabel.TextColor3 = Color3.fromRGB(100, 100, 110)
	statusLabel.TextSize = 10
	statusLabel.Font = Enum.Font.Gotham
	statusLabel.Parent = mainFrame

	-- ============ INFORMATION TAB ============
	local infoPage = createContentPage("Information")
	tabContents["Information"] = infoPage

	createSectionHeader(infoPage, "Update Log", 0)

	local updateLog = Instance.new("TextLabel")
	updateLog.Size = UDim2.new(1, -10, 0, 150)
	updateLog.Position = UDim2.new(0, 5, 0, 30)
	updateLog.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
	updateLog.Text = [[
  v2.0.0 - Major Update
  
  + Added compact ESP system
  + Fixed tracking through walls
  + New professional UI
  + Hold/Toggle tracking modes
  + Team & Admin filtering
  + Improved performance
  
  Known Issues:
  - Some games may have anti-cheat
  ]]
	updateLog.TextColor3 = Color3.fromRGB(180, 180, 185)
	updateLog.TextSize = 11
	updateLog.Font = Enum.Font.Code
	updateLog.TextXAlignment = Enum.TextXAlignment.Left
	updateLog.TextYAlignment = Enum.TextYAlignment.Top
	updateLog.TextWrapped = true
	updateLog.Parent = infoPage

	local logCorner = Instance.new("UICorner")
	logCorner.CornerRadius = UDim.new(0, 4)
	logCorner.Parent = updateLog

	local logPadding = Instance.new("UIPadding")
	logPadding.PaddingLeft = UDim.new(0, 10)
	logPadding.PaddingTop = UDim.new(0, 10)
	logPadding.Parent = updateLog

	-- ============ LOCAL PLAYER TAB ============
	local localPage = createContentPage("Local Player")
	tabContents["Local Player"] = localPage

	createSectionHeader(localPage, "Character", 0)

	local godModeEnabled = false
	local godModeConnection = nil
	local speedBoostEnabled = false

	createToggleRow(localPage, "God Mode", 30, false, function(enabled)
		godModeEnabled = enabled
		if enabled then
			godModeConnection = RunService.Heartbeat:Connect(function()
				local char = player.Character
				if char then
					local humanoid = char:FindFirstChild("Humanoid")
					if humanoid then
						humanoid.Health = humanoid.MaxHealth
					end
				end
			end)
			statusLabel.Text = "God Mode enabled"
		else
			if godModeConnection then
				godModeConnection:Disconnect()
				godModeConnection = nil
			end
			statusLabel.Text = "God Mode disabled"
		end
	end)

	createToggleRow(localPage, "Speed Boost (100)", 65, false, function(enabled)
		speedBoostEnabled = enabled
		local char = player.Character
		if char then
			local humanoid = char:FindFirstChild("Humanoid")
			if humanoid then
				humanoid.WalkSpeed = enabled and 100 or 16
				statusLabel.Text = enabled and "Speed Boost enabled" or "Speed Boost disabled"
			end
		end
	end)

	createSectionHeader(localPage, "Inventory", 110)

	createButtonRow(localPage, "Unlock All Items", 140, function()
		local itemsFolder = ServerStorage:FindFirstChild("Items")
		if itemsFolder then
			for _, item in ipairs(itemsFolder:GetChildren()) do
				local clone = item:Clone()
				clone.Parent = player.Backpack
			end
		end

		local leaderstats = player:FindFirstChild("leaderstats")
		if leaderstats then
			for _, stat in ipairs(leaderstats:GetChildren()) do
				if stat:IsA("IntValue") or stat:IsA("NumberValue") then
					stat.Value = 999999
				end
			end
		end

		statusLabel.Text = "Unlocked all items & max currency"
	end)

	-- ============ VISUALS TAB ============
	local visualsPage = createContentPage("Visuals")
	tabContents["Visuals"] = visualsPage

	createSectionHeader(visualsPage, "ESP Settings", 0)

	createToggleRow(visualsPage, "Enable ESP", 30, false, function(enabled)
		if enabled then
			enableESP(player)
			statusLabel.Text = "ESP enabled (enemies only)"
		else
			clearAllESP(player)
			statusLabel.Text = "ESP disabled"
		end
	end)

	createToggleRow(visualsPage, "Box Outline", 65, true, function(enabled)
		espSettings[player.UserId].boxEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Tracer Lines", 100, true, function(enabled)
		espSettings[player.UserId].tracerEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Player Names", 135, true, function(enabled)
		espSettings[player.UserId].nameEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Health Bars", 170, true, function(enabled)
		espSettings[player.UserId].healthEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	createToggleRow(visualsPage, "Distance Display", 205, true, function(enabled)
		espSettings[player.UserId].distanceEnabled = enabled
		if espEnabled[player.UserId] then
			clearAllESP(player)
			enableESP(player)
		end
	end)

	-- ============ COMMANDS TAB ============
	local commandsPage = createContentPage("Commands")
	tabContents["Commands"] = commandsPage

	createSectionHeader(commandsPage, "Target Player", 0)

	local _, playerInput = createInputRow(commandsPage, "Enter player name...", 30)

	createSectionHeader(commandsPage, "Actions", 75)

	createButtonRow(commandsPage, "Teleport to Player", 105, function()
		local targetName = playerInput.Text
		if targetName == "" then
			statusLabel.Text = "Enter a player name first"
			return
		end

		local target = findPlayer(targetName)
		if not target then
			statusLabel.Text = "Player not found"
			return
		end

		local adminChar = player.Character
		local targetChar = target.Character

		if adminChar and targetChar then
			local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if adminHRP and targetHRP then
				adminHRP.CFrame = targetHRP.CFrame * CFrame.new(0, 0, 3)
				statusLabel.Text = "Teleported to " .. target.Name
			end
		end
	end)

	createButtonRow(commandsPage, "Bring Player to You", 142, function()
		local targetName = playerInput.Text
		if targetName == "" then
			statusLabel.Text = "Enter a player name first"
			return
		end

		local target = findPlayer(targetName)
		if not target then
			statusLabel.Text = "Player not found"
			return
		end

		local adminChar = player.Character
		local targetChar = target.Character

		if adminChar and targetChar then
			local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if adminHRP and targetHRP then
				targetHRP.CFrame = adminHRP.CFrame * CFrame.new(0, 0, 3)
				statusLabel.Text = "Brought " .. target.Name
			end
		end
	end)

	createButtonRow(commandsPage, "Locate All Enemies", 179, function()
		local count = 0
		for _, p in ipairs(Players:GetPlayers()) do
			if isValidTarget(player, p) then
				local char = p.Character
				if char then
					local hrp = char:FindFirstChild("HumanoidRootPart")
					if hrp then
						count = count + 1
						local canSee = hasLineOfSight(player, p)
						print(string.format("[LOCATE] %s %s: X:%.0f Y:%.0f Z:%.0f", canSee and "â—‰" or "â—Ž", p.Name, hrp.Position.X, hrp.Position.Y, hrp.Position.Z))
					end
				end
			end
		end
		statusLabel.Text = "Located " .. count .. " enemies (check console)"
	end)

	-- ============ TRACKING TAB ============
	local trackingPage = createContentPage("Tracking")
	tabContents["Tracking"] = trackingPage

	createSectionHeader(trackingPage, "RMB Tracking Mode", 0)

	-- Mode selection
	local holdModeBtn, holdLabel = createButtonRow(trackingPage, "â— Hold to Track", 30, function()
		trackingMode[player.UserId] = "hold"
		statusLabel.Text = "Tracking mode: Hold RMB"
	end)

	local toggleModeBtn, toggleLabel = createButtonRow(trackingPage, "â—‹ Click to Toggle", 67, function()
		trackingMode[player.UserId] = "toggle"
		statusLabel.Text = "Tracking mode: Click RMB"
	end)

	createSectionHeader(trackingPage, "Manual Tracking", 115)

	local _, trackInput = createInputRow(trackingPage, "Enter player name...", 145)

	createButtonRow(trackingPage, "Start Camera Track", 185, function()
		local targetName = trackInput.Text
		if targetName == "" then
			statusLabel.Text = "Enter a player name first"
			return
		end

		stopTracking(player)

		local target = findPlayer(targetName)
		if not target then
			statusLabel.Text = "Player not found"
			return
		end

		if not isValidTarget(player, target) then
			statusLabel.Text = "Cannot track this player"
			return
		end

		statusLabel.Text = "Tracking " .. target.Name

		local camera = Workspace.CurrentCamera

		local connection = RunService.RenderStepped:Connect(function()
			local adminChar = player.Character
			local targetChar = target.Character

			if not adminChar or not targetChar then return end

			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if targetHRP and camera then
				local canSee = hasLineOfSight(player, target)

				if canSee then
					local lookAtCFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position)
					camera.CFrame = camera.CFrame:Lerp(lookAtCFrame, 0.1)
				end
			end
		end)

		activeTracking[player.UserId] = {
			connection = connection,
			target = target
		}
	end)

	createButtonRow(trackingPage, "Stop Tracking", 222, function()
		if stopTracking(player) then
			statusLabel.Text = "Tracking stopped"
		else
			statusLabel.Text = "Not tracking anyone"
		end
	end)

	-- ============ MAP TAB ============
	local mapPage = createContentPage("Map")
	tabContents["Map"] = mapPage

	createSectionHeader(mapPage, "Map Features", 0)

	local mapInfo = Instance.new("TextLabel")
	mapInfo.Size = UDim2.new(1, -10, 0, 60)
	mapInfo.Position = UDim2.new(0, 5, 0, 30)
	mapInfo.BackgroundTransparency = 1
	mapInfo.Text = "Map features coming soon...\n\nPlanned: Minimap, waypoints, enemy radar"
	mapInfo.TextColor3 = Color3.fromRGB(120, 120, 130)
	mapInfo.TextSize = 12
	mapInfo.Font = Enum.Font.Gotham
	mapInfo.TextXAlignment = Enum.TextXAlignment.Left
	mapInfo.TextWrapped = true
	mapInfo.Parent = mapPage

	-- ============ MISCELLANEOUS TAB ============
	local miscPage = createContentPage("Miscellaneous")
	tabContents["Miscellaneous"] = miscPage

	createSectionHeader(miscPage, "Extra Features", 0)

	createButtonRow(miscPage, "Rejoin Server", 30, function()
		TeleportService:Teleport(game.PlaceId, player)
	end)

	createButtonRow(miscPage, "Copy Server ID", 67, function()
		-- Can't copy to clipboard in Roblox but we can print it
		print("Server ID: " .. game.JobId)
		statusLabel.Text = "Server ID printed to console"
	end)

	-- ============ UI SETTINGS TAB ============
	local settingsPage = createContentPage("UI Settings")
	tabContents["UI Settings"] = settingsPage

	createSectionHeader(settingsPage, "Appearance", 0)

	local uiInfo = Instance.new("TextLabel")
	uiInfo.Size = UDim2.new(1, -10, 0, 40)
	uiInfo.Position = UDim2.new(0, 5, 0, 30)
	uiInfo.BackgroundTransparency = 1
	uiInfo.Text = "UI customization coming soon...\n\nPress Right Ctrl to toggle this panel"
	uiInfo.TextColor3 = Color3.fromRGB(120, 120, 130)
	uiInfo.TextSize = 12
	uiInfo.Font = Enum.Font.Gotham
	uiInfo.TextXAlignment = Enum.TextXAlignment.Left
	uiInfo.TextWrapped = true
	uiInfo.Parent = settingsPage

	-- Tab switching function
	local function switchTab(tabName)
		currentTab[player.UserId] = tabName

		for name, data in pairs(tabButtons) do
			if name == tabName then
				data.button.BackgroundTransparency = 0
				data.button.BackgroundColor3 = Color3.fromRGB(30, 30, 38)
				data.indicator.Visible = true
				data.label.TextColor3 = Color3.fromRGB(255, 255, 255)
			else
				data.button.BackgroundTransparency = 1
				data.indicator.Visible = false
				data.label.TextColor3 = Color3.fromRGB(180, 180, 185)
			end
		end

		for name, content in pairs(tabContents) do
			content.Visible = (name == tabName)
		end
	end

	-- Connect tab buttons
	for name, data in pairs(tabButtons) do
		data.button.MouseButton1Click:Connect(function()
			switchTab(name)
		end)

		data.button.MouseEnter:Connect(function()
			if currentTab[player.UserId] ~= name then
				TweenService:Create(data.button, TweenInfo.new(0.1), {BackgroundTransparency = 0.5}):Play()
			end
		end)

		data.button.MouseLeave:Connect(function()
			if currentTab[player.UserId] ~= name then
				TweenService:Create(data.button, TweenInfo.new(0.1), {BackgroundTransparency = 1}):Play()
			end
		end)
	end

	-- Default to Information tab
	switchTab("Information")

	-- RMB Tracking Functions
	local function startRMBTracking()
		stopRightMouseTracking(player)

		local nearestPlayer, distance = getNearestValidTarget(player)
		if not nearestPlayer then
			statusLabel.Text = "No visible enemies nearby"
			return
		end

		statusLabel.Text = "RMB tracking " .. nearestPlayer.Name

		local camera = Workspace.CurrentCamera

		local connection = RunService.RenderStepped:Connect(function()
			local currentNearest, dist = getNearestValidTarget(player)
			if not currentNearest then return end

			local adminChar = player.Character
			local targetChar = currentNearest.Character

			if not adminChar or not targetChar then return end

			local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")

			if targetHRP and camera then
				local lookAtCFrame = CFrame.new(camera.CFrame.Position, targetHRP.Position)
				camera.CFrame = camera.CFrame:Lerp(lookAtCFrame, 0.2)
				statusLabel.Text = "Tracking: " .. currentNearest.Name .. " (" .. string.format("%.0fm", dist) .. ")"
			end
		end)

		rightMouseTracking[player.UserId] = {
			connection = connection
		}
	end

	local function stopRMBTrackingUI()
		stopRightMouseTracking(player)
		if not activeTracking[player.UserId] then
			statusLabel.Text = "Ready â€¢ Right Ctrl to toggle"
		end
	end

	-- Input handling
	UserInputService.InputBegan:Connect(function(input, gameProcessed)
		if gameProcessed then return end

		if input.KeyCode == Enum.KeyCode.RightControl then
			mainFrame.Visible = not mainFrame.Visible
		end

		if input.UserInputType == Enum.UserInputType.MouseButton2 then
			if trackingMode[player.UserId] == "hold" then
				startRMBTracking()
			else
				if toggleTrackingActive[player.UserId] then
					toggleTrackingActive[player.UserId] = false
					stopRMBTrackingUI()
				else
					toggleTrackingActive[player.UserId] = true
					startRMBTracking()
				end
			end
		end
	end)

	UserInputService.InputEnded:Connect(function(input, gameProcessed)
		if input.UserInputType == Enum.UserInputType.MouseButton2 then
			if trackingMode[player.UserId] == "hold" then
				stopRMBTrackingUI()
			end
		end
	end)

	-- Close button
	closeBtn.MouseButton1Click:Connect(function()
		mainFrame.Visible = false
	end)

	closeBtn.MouseEnter:Connect(function()
		closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
	end)

	closeBtn.MouseLeave:Connect(function()
		closeBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
	end)
end

-- Give GUI to admins
Players.PlayerAdded:Connect(function(player)
	if isAdmin(player) then
		createAdminGui(player)
	end
end)

-- For admins already in game
for _, player in ipairs(Players:GetPlayers()) do
	if isAdmin(player) then
		createAdminGui(player)
	end
end
